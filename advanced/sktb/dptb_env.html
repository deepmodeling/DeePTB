<!doctypehtml><html data-content_root=../../ lang=en><head><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><meta content=width=device-width,initial-scale=1 name=viewport><title>Environment-dependent TB — DeePTB  documentation</title><script data-cfasync=false>document.documentElement.dataset.mode=localStorage.getItem(`mode`)||``;document.documentElement.dataset.theme=localStorage.getItem(`theme`)||``</script><link href=../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link href=../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link href=../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link href=../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2 rel=preload type=font/woff2><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2 rel=preload type=font/woff2><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2 rel=preload type=font/woff2><link href=../../_static/pygments.css?v=8f2a1f02 rel=stylesheet><link href=../../_static/styles/sphinx-book-theme.css?v=eba8b062 rel=stylesheet><link href=../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css rel=stylesheet><link href=../../_static/banner.css?v=f1520836 rel=stylesheet><link as=script href=../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b rel=preload><link as=script href=../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b rel=preload><script src=../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b></script><script src=../../_static/documentation_options.js?v=9eb32ce0></script><script src=../../_static/doctools.js?v=9bcbadda></script><script src=../../_static/sphinx_highlight.js?v=dc90522c></script><script src=../../_static/scripts/sphinx-book-theme.js?v=887ef09a></script><script>window.MathJax={"options":{"processHtmlClass":`tex2jax_process|mathjax_process|math|output_area`}}</script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js></script><script src=../../_static/banner.js?v=a6a668d4></script><script>DOCUMENTATION_OPTIONS.pagename=`advanced/sktb/dptb_env`</script><link href=../../genindex.html rel=index title=Index><link href=../../search.html rel=search title=Search><link title="NRL-TB paramererization"href=nrl_tb.html rel=next><link title="DFTB SK Files to DeePTB Model"href=dftb.html rel=prev><meta content=width=device-width,initial-scale=1 name=viewport><meta content=en name=docsearch:language><link href=https://unpkg.com/ rel=preconnect><link href=https://unpkg.com/@njzjz/icons@0.0.5/logos/deepmodeling.svg rel=icon type=image/png><div class="container-fluid header-holder tutorials-header"id=header-holder><div class=container><div class=header-container><a aria-label=deepmodeling class=header-logo href=https://deepmodeling.com></a><div class=main-menu><ul><li><a href=https://deepmodeling.com>Home</a></li><li><a href=https://blogs.deepmodeling.com>Blog</a></li><li><a href=https://tutorials.deepmodeling.com>Tutorials</a></li><li class="active docs-active"><div class=resources-dropdown data-toggle=resources-dropdown id=resourcesDropdownButton><a class="resource-option with-down-orange-arrow"href=https://docs.deepmodeling.com/> Docs </a><div class=resources-dropdown-menu><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/deepmd/> <span class=dropdown-title>DeePMD-kit</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpgen/> <span class=dropdown-title>DP-GEN</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpdata/> <span class=dropdown-title>dpdata</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpdispatcher/> <span class=dropdown-title>DPDispatcher</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://abacus.deepmodeling.com/> <span class=dropdown-title>ABACUS</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://deepflame.deepmodeling.com/> <span class=dropdown-title>DeepFlame</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpti/> <span class=dropdown-title>DPTI</span> <p></p> </a></div></div></li><li><a href=https://blogs.deepmodeling.com/papers/>Publications</a></li><li><a href=https://github.com/deepmodeling>GitHub</a></li></ul></div><a class=main-menu-open-button data-behavior=open-mobile-menu href=#></a></div></div></div><div class=mobile-main-menu><div class=container-fluid><div class=container><div class=mobile-main-menu-header-container><a aria-label=deepmodeling class=header-logo href=https://deepmodeling.com></a><a class=main-menu-close-button data-behavior=close-mobile-menu href=#></a></div></div></div><div class=mobile-main-menu-links-container><div class=main-menu><ul><li><a href=https://deepmodeling.com>Home</a></li><li><a href=https://blogs.deepmodeling.com>Blog</a></li><li><a href=https://tutorials.deepmodeling.com>Tutorials</a></li><li><a href=https://docs.deepmodeling.com/>Docs</a></li><li><a href=https://blogs.deepmodeling.com/papers/>Publications</a></li><li><a href=https://github.com/deepmodeling>GitHub</a></li></ul></div></div></div></head><body data-bs-root-margin="0px 0px -60%"data-bs-spy=scroll data-bs-target=.bd-toc-nav data-default-mode data-offset=180><div class="skip-link d-print-none"id=pst-skip-link><a href=#main-content>Skip to main content</a></div><div id=pst-scroll-pixel-helper></div><button class="btn rounded-pill"id=pst-back-to-top type=button><i class="fa-solid fa-arrow-up"></i>Back to top</button><input class=sidebar-toggle id=pst-primary-sidebar-checkbox type=checkbox><label class="overlay overlay-primary"for=pst-primary-sidebar-checkbox></label><input class=sidebar-toggle id=pst-secondary-sidebar-checkbox type=checkbox><label class="overlay overlay-secondary"for=pst-secondary-sidebar-checkbox></label><div class=search-button__wrapper><div class=search-button__overlay></div><div class=search-button__search-container><form class="bd-search d-flex align-items-center"action=../../search.html><i class="fa-solid fa-magnifying-glass"></i><input aria-label=Search... autocapitalize=off autocomplete=off autocorrect=off class=form-control id=search-input name=q placeholder=Search... spellcheck=false type=search><span class=search-button__kbd-shortcut><kbd class=kbd-shortcut__modifier>Ctrl</kbd>+<kbd>K</kbd></span></form></div></div><div class="pst-async-banner-revealer d-none"><aside aria-label="Version warning"class="d-none d-print-none"id=bd-header-version-warning></aside></div><header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none"></header><div class=bd-container><div class="bd-container__inner bd-page-width"><div class="bd-sidebar-primary bd-sidebar"><div class="sidebar-header-items sidebar-primary__section"></div><div class="sidebar-primary-items__start sidebar-primary__section"><div class=sidebar-primary-item><a class="navbar-brand logo"href=../../index.html> <img alt="DeePTB  documentation - Home"class="logo__image only-light"src=../../_static/deeptb-logo.svg> <script>document.write(`<img src="../../_static/deeptb-logo.svg" class="logo__image only-dark" alt="DeePTB  documentation - Home"/>`)</script> </a></div><div class=sidebar-primary-item><script>document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `)</script></div><div class=sidebar-primary-item><nav class="bd-links bd-docs-nav"aria-label=Main><div class="bd-toc-item navbar-nav active"><p aria-level=2 class=caption role=heading><span class=caption-text>Quick Start</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../quick_start/easy_install.html>Installation Guide</a></li><li class=toctree-l1><a class="reference internal"href=../../quick_start/input.html>Brief Intro. to Inputs and Commands</a></li><li class="toctree-l1 has-children"><a class="reference internal"href=../../quick_start/hands_on/index.html>A quick Example</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../quick_start/hands_on/sktb_hands_on.html>DeePTB-SK: h-BN</a></li><li class=toctree-l2><a class="reference internal"href=../../quick_start/hands_on/e3tb_hands_on.html>DeePTB-E3: Bulk Silicon</a></li><li class=toctree-l2><a class="reference internal"href=../../quick_start/hands_on/tutorial1_base_sk.html>DeePTB Tutorial 1: deeptb-sk baseline model [v2.2]</a></li></ul></details></li><li class=toctree-l1><a class="reference internal"href=../../quick_start/basic_api.html>Basic API</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>INPUT TAG</span></p><ul class="nav bd-sidenav"><li class="toctree-l1 has-children"><a class="reference internal"href=../../input_params/index.html>Full Input Parameters</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../input_params/common_options.html>Common Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/train_options.html>Train Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/model_options.html>Model Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/data_options.html>Data Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/run_options.html>Run Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/set_info.html>Set Info</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Advanced</span></p><ul class="current nav bd-sidenav"><li class="toctree-l1 current active has-children"><a class="reference internal"href=index.html>DeePTB-SK Advanced</a><details open><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul class=current><li class=toctree-l2><a class="reference internal"href=dftb.html>DFTB SK Files to DeePTB Model</a></li><li class="toctree-l2 current active"><a class="current reference internal"href=#>Environment-dependent TB</a></li><li class=toctree-l2><a class="reference internal"href=nrl_tb.html>NRL-TB paramererization</a></li><li class=toctree-l2><a class="reference internal"href=soc.html>Spin-orbit coupling</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal"href=../e3tb/index.html>DeePTB-E3 Advanced</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../e3tb/advanced_input.html>More on Input Parameters</a></li><li class=toctree-l2><a class="reference internal"href=../e3tb/data_preparation.html>Data Preparation</a></li><li class=toctree-l2><a class="reference internal"href=../e3tb/loss_analysis.html>Loss Analysis</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal"href=../elec_properties/index.html>Electronic Properties and Outputs</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../elec_properties/band.html>Band structure</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal"href=../interface/index.html>Interfaces to Other Softwares</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../interface/TBPLAS.html>TBPLAS</a></li><li class=toctree-l2><a class="reference internal"href=../interface/TBtrans.html>TBtrans</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Citing DeePTB</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../CITATIONS.html>How to Cite</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Developing Team</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../DevelopingTeam.html>Development Team</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Community</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../community/contribution_guide.html>DeePTB Contribution Guide</a></li><li class=toctree-l1><a class="reference internal"href=../../CONTRIBUTING.html>Contributing to DeePTB</a></li></ul></div></nav></div></div><div class="sidebar-primary-items__end sidebar-primary__section"></div><div id=rtd-footer-container></div></div><main class=bd-main id=main-content role=main><div class=sbt-scroll-pixel-helper></div><div class=bd-content><div class=bd-article-container><div class="bd-header-article d-print-none"><div class="header-article-items header-article__inner"><div class=header-article-items__start><div class=header-article-item><button class="sidebar-toggle primary-toggle btn btn-sm"title="Toggle primary sidebar"data-bs-placement=bottom data-bs-toggle=tooltip><span class="fa-solid fa-bars"></span></button></div></div><div class=header-article-items__end><div class=header-article-item><div class=article-header-buttons><div class="dropdown dropdown-download-buttons"><button aria-label="Download this page"class="btn dropdown-toggle"aria-expanded=false data-bs-toggle=dropdown type=button><i class="fas fa-download"></i></button><ul class=dropdown-menu><li><a class="btn btn-sm btn-download-source-button dropdown-item"title="Download source file"data-bs-placement=left data-bs-toggle=tooltip href=../../_sources/advanced/sktb/dptb_env.md target=_blank> <span class=btn__icon-container> <i class="fas fa-file"></i> </span> <span class=btn__text-container>.md</span> </a></li><li><button class="btn btn-sm btn-download-pdf-button dropdown-item"title="Print to PDF"data-bs-placement=left data-bs-toggle=tooltip onclick=window.print()><span class=btn__icon-container> <i class="fas fa-file-pdf"></i> </span> <span class=btn__text-container>.pdf</span></button></li></ul></div><button class="btn btn-sm btn-fullscreen-button"title="Fullscreen mode"data-bs-placement=bottom data-bs-toggle=tooltip onclick=toggleFullScreen()><span class=btn__icon-container> <i class="fas fa-expand"></i> </span></button><script>document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`)</script><script>document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`)</script><button class="sidebar-toggle secondary-toggle btn btn-sm"title="Toggle secondary sidebar"data-bs-placement=bottom data-bs-toggle=tooltip><span class="fa-solid fa-list"></span></button></div></div></div></div></div><div class=onlyprint id=jb-print-docs-body><h1>Environment-dependent TB</h1><div id=print-main-content><div id=jb-print-toc><div><h2>Contents</h2></div><nav aria-label=Page><ul class="visible nav section-nav flex-column"><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link"href=#method-introduction>Method Introduction:</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link"href=#example-bulk-silicon>Example: Bulk Silicon</a><ul class="nav section-nav flex-column"><li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link"href=#data-preparation>1. Data Preparation</a></li><li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link"href=#training-neural-network-emperical-tb-model-no-env>2. Training Neural Network Emperical TB Model (no env)</a><ul class="nav section-nav flex-column"><li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link"href=#training-a-first-nearest-neighbour-model>2.1 Training a First Nearest Neighbour Model</a></li><li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link"href=#add-more-orbitals-and-neighbours>2.2 Add More Orbitals and Neighbours</a></li><li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link"href=#training-the-bond-length-dependent-parameters>2.3 Training the Bond-length Dependent Parameters</a></li></ul></li><li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link"href=#training-deep-learning-tb-models-with-env-correction>3. Training Deep Learning TB Models with Env. Correction</a></li></ul></li></ul></nav></div></div></div><div id=searchbox></div><article class=bd-article><section class="tex2jax_ignore mathjax_ignore"id=environment-dependent-tb><h1>Environment-dependent TB<a title="Link to this heading"class=headerlink href=#environment-dependent-tb>#</a></h1><ul class=simple><li><p><a class="reference internal"href=#method-introduction>Method Introduction:</a></p></li><li><p><a class="reference internal"href=#example-bulk-silicon>Example: Bulk Silicon</a></p> <ul><li><p><a class="reference internal"href=#data-preparation>1. Data Preparation</a></p></li><li><p><a class="reference internal"href=#training-neural-network-emperical-tb-model-no-env> 2. Training Neural Network Emperical TB Model (nnsk model) </a></p> <ul><li><p><a class="reference internal"href=#training-a-first-nearest-neighbour-model> 2.1 Training a First Nearest Neighbour Model </a></p></li><li><p><a class="reference internal"href=#add-more-orbitals-and-neighbours> 2.2 Add More Orbitals and Neighbours </a></p></li><li><p><a class="reference internal"href=#training-the-bond-length-dependent-parameters> 2.3 Training the Bond-length Dependent Parameters </a></p></li></ul></li><li><p><a class="reference internal"href=#training-deep-learning-tb-models-with-env-correction> 3. Training Deep Learning TB Models with Env. Correction </a></p></li></ul></li></ul><section id=method-introduction><h2>Method Introduction:<a title="Link to this heading"class=headerlink href=#method-introduction>#</a></h2><p>The basic idea of the DeePTB method is to fit the DFT electronic band structure through deep learning, thereby constructing a TB model to achieve first-principles accuracy.</p><p>In the TB model, the Hamiltonian matrix elements can be expressed as:</p><div class="math notranslate nohighlight">\[ \begin{equation} H_{i,j}^{lm,l^\prime m^\prime} = \left\langle {i,lm} \right| \hat{H} \left| {j, l^\prime m^\prime} \right\rangle \end{equation} \]</div><p>where <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span> are site indices. <span class="math notranslate nohighlight">\(l\)</span> and <span class="math notranslate nohighlight">\(m\)</span> are angular and magnetic quantum numbers. <span class="math notranslate nohighlight">\(H\)</span> is the Hamiltonian operator. In DeePTB, we choose the traditional Slater-Koster (SK) parameterized Hamiltonian, where all the Hamiltonian can be expressed in terms of SK integrals: <span class="math notranslate nohighlight">\(h_{ss\sigma}, h_{sp\sigma}, h_{pp\sigma}, h_{pp\pi}, \cdots\)</span>, etc. Based on these SK integrals, we can construct Hamiltonian matrix as follows:</p><div class="math notranslate nohighlight">\[ \begin{equation} H_{i,j}^{lm,l^\prime m^\prime} = \sum_{\zeta} \Big[ \mathcal{U}_{\zeta}(\hat{r}_{ij}) \ h_{ll^\prime \zeta} \Big]_{mm^\prime} \end{equation} \]</div><p>Here, <span class="math notranslate nohighlight">\(\mathcal{U}_{\zeta}\)</span> is a <span class="math notranslate nohighlight">\([2l+1,2l^\prime+1]\)</span> matrix, and <span class="math notranslate nohighlight">\(\zeta\)</span> represents the key type, such as <span class="math notranslate nohighlight">\(\sigma, \pi\)</span>, etc. The specific form of <span class="math notranslate nohighlight">\(\mathcal{U}_{\zeta}\)</span> can be found in <a class="reference external"href=https://journals.aps.org/pr/abstract/10.1103/PhysRev.94.1498>Ref:1</a>.In traditional SK-TB, SK integrals often use analytical expressions based on the following empirical rules, and are based on the two-center approximation.</p><p>In DeePTB, we use a neural network-based method to predict SK integrals, which is expressed as:</p><div class="math notranslate nohighlight">\[ \begin{equation} h^{\text{env}}_{ll^\prime{\zeta}} = h_{ll^\prime{\zeta}}(r_{ij}) \times \left[1+\Phi_{ll^\prime\zeta}^{o_i,o_j}\left(r_{ij},\mathcal{D}^{ij}\right)\right] \end{equation} \]</div><p>where <span class="math notranslate nohighlight">\(h_{ll^\prime{\zeta}}\)</span> is also an SK integral based on an analytical expression. In DeePTB, the undetermined coefficients of the analytical expression are represented by neurons. <span class="math notranslate nohighlight">\(h^{\text{env}}_{ll^\prime{\zeta}}\)</span> depends on the local environment introduced by the neural network. Refer to <a class="reference external"href=https://journals.aps.org/prmaterials/abstract/10.1103/PhysRevMaterials.2.083801>DeePTB paper</a> for more information.</p><p>In the following, we will use Silicon as an example to show the full training procedure of DeePTB.</p></section><section id=example-bulk-silicon><h2>Example: Bulk Silicon<a title="Link to this heading"class=headerlink href=#example-bulk-silicon>#</a></h2><p>Bulk silicon has diamond structure at room temperature and pressure. Due to its widespread applications in the semiconductor industry, it has been a significant important element in modern society. Here we provide an example of building a silicon <strong>DeePTB</strong> model. By following this instruction step-by-step, you will be introduced to the high-level functionalities of <strong>DeePTB</strong>, which can provide a model bypass empirical TB, to achieve <em>ab initio</em> accuracy.</p><p>This example can be seen in the <code class="docutils literal notranslate"><span class=pre>example/silicon</span></code> folder. The whole training procedure can be summarized as below:</p><a class="reference internal image-reference"href=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/model_arch.png><img alt=procedure src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/model_arch.png style=width:500px> </a><p>This procedure contains the full steps to training an environmentally corrected <strong>DeePTB</strong> model. The converged model can predict the electronic structure of both perfect crystals and the configurations with atomic distortion, while can generalize to structures with more atoms.</p><section id=data-preparation><h3>1. Data Preparation<a title="Link to this heading"class=headerlink href=#data-preparation>#</a></h3><p>The data for training and plotting contains in <code class="docutils literal notranslate"><span class=pre>data</span></code> folders:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>deeptb/examples/silicon/data/
<span class=p>|</span>--<span class=w> </span>kpath.0<span class=w>                 </span><span class=c1># train data of primary cell. (k-path bands)</span>
<span class=p>|</span>--<span class=w> </span>kpathmd25.0<span class=w>             </span><span class=c1># train data of 10 MD snapshots at T=25K   (k-path bands)</span>
<span class=p>|</span>--<span class=w> </span>kpathmd100.0<span class=w>            </span><span class=c1># train data of 10 MD snapshots at T=100K  (k-path bands)</span>
<span class=p>|</span>--<span class=w> </span>kpathmd300.0<span class=w>            </span><span class=c1># train data of 10 MD snapshots at T=300K  (k-path bands)</span>
<span class=p>|</span>--<span class=w> </span>kpt.0<span class=w>                   </span><span class=c1># kmesh samples of primary cell  (k-mesh bands)</span>
<span class=p>|</span>--<span class=w> </span>kpath_spk.0
<span class=p>|</span>--<span class=w> </span>silicon.vasp<span class=w>            </span><span class=c1># structure of primary cell</span>
</pre></div></div><p>Each of these folders, contains data files with required format, here we give an examples of <code class="docutils literal notranslate"><span class=pre>kpath.0</span></code>:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>deeptb/examples/silicon/data/kpath.0/
--<span class=w> </span>info.json
--<span class=w> </span>eigs.npy
--<span class=w> </span>kpoints.npy
--<span class=w> </span>xdat.traj
</pre></div></div><p>The meaning and useage of the files can refer to <code class="docutils literal notranslate"><span class=pre>../quick_start/input.md</span></code>.</p></section><section id=training-neural-network-emperical-tb-model-no-env><h3>2. Training Neural Network Emperical TB Model (no env)<a title="Link to this heading"class=headerlink href=#training-neural-network-emperical-tb-model-no-env>#</a></h3><section id=training-a-first-nearest-neighbour-model><h4>2.1 Training a First Nearest Neighbour Model<a title="Link to this heading"class=headerlink href=#training-a-first-nearest-neighbour-model>#</a></h4><p>We first analyse the bond length by running.</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>bond<span class=w> </span>./data/silicon.vasp
</pre></div></div><p>The output will be like:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span><span class=w> </span>Bond<span class=w> </span>Type<span class=w>         </span><span class=m>1</span><span class=w>         </span><span class=m>2</span><span class=w>         </span><span class=m>3</span><span class=w>         </span><span class=m>4</span><span class=w>         </span><span class=m>5</span>
------------------------------------------------------------------------
<span class=w>     </span>Si-Si<span class=w>      </span><span class=m>2</span>.35<span class=w>      </span><span class=m>3</span>.84<span class=w>      </span><span class=m>4</span>.50<span class=w>      </span><span class=m>5</span>.43<span class=w>      </span><span class=m>5</span>.92
</pre></div></div><p>The fitting of empirical TB on the first nearest neighbours shares the same procedure as the <code class="docutils literal notranslate"><span class=pre>hBN</span></code> example. We suggest the user try on hBN before proceeding. This time, the training starts from the first nearest neighbour checkpoint in <code class="docutils literal notranslate"><span class=pre>input</span></code> folder. Run the following command to train the first <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>./input/2-1_input.json<span class=w> </span>-o<span class=w> </span>./nnsk
</pre></div></div></section><section id=add-more-orbitals-and-neighbours><h4>2.2 Add More Orbitals and Neighbours<a title="Link to this heading"class=headerlink href=#add-more-orbitals-and-neighbours>#</a></h4><p>We can plot the converged <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model in last step just as in <code class="docutils literal notranslate"><span class=pre>hBN</span></code> example using <code class="docutils literal notranslate"><span class=pre>band_plot.py</span></code> script.</p><a class="reference internal image-reference"href=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_nnsk.png><img alt=nnsk_first src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_nnsk.png style=width:500px> </a><p>After plotting, we can find that the first fitted model has already captured the shape of the valance bands. However, the conductance band is less accurate since the orbitals <code class="docutils literal notranslate"><span class=pre>3s</span></code> and <code class="docutils literal notranslate"><span class=pre>3p</span></code> is not complete for the space spanned by the considered valance and conductance band. Therefore we need to include more orbitals in the model.</p><p>In <strong>DeePTB</strong>, users are able to add or remove orbitals by altering the input configuration file. Here we add <code class="docutils literal notranslate"><span class=pre>d*</span></code> orbital, which can permit us to fit the conductance band essential when calculating excitation properties such as photo-electronics and electronic transport.</p><p>First, we add <code class="docutils literal notranslate"><span class=pre>d*</span></code> in <code class="docutils literal notranslate"><span class=pre>proj_atom_anglr_m</span></code> of input configuration, which looks like this:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=nt>"basis"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>"Si"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>"3s"</span><span class=p>,</span><span class=w> </span><span class=s2>"3p"</span><span class=p>,</span><span class=w> </span><span class=s2>"d*"</span><span class=p>]</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>Also, we can correct the onsite energies of the TB orbitals using <code class="docutils literal notranslate"><span class=pre>strain</span></code> method. The <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model now looks like:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"strain"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>2.5</span><span class=w> </span><span class=p>,</span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>2.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>Then, we can start training the model with <code class="docutils literal notranslate"><span class=pre>-i/--init-model</span></code> of our last checkpoint, by running:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>./input/2-2-1_input.json<span class=w> </span>-i<span class=w> </span>./nnsk/checkpoint/nnsk.ep495.pth<span class=w> </span>-o<span class=w> </span>./nnsk_2
</pre></div></div><p>In this way, the parameters in <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model corresponding to <code class="docutils literal notranslate"><span class=pre>3s</span></code> and <code class="docutils literal notranslate"><span class=pre>3p</span></code> orbitals can be reloaded. When convergence is achieved, we can plot the band structure again, which shows that both the valance and conductance bands are fitted well:</p><a class="reference internal image-reference"href=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_strain.png><img alt=nnsk_strain src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_strain.png style=width:500px> </a><p><em>Note: In practice, we find that training with the minimal basis set in begin, and then increasing the orbitals gradually is a better choice than directly training with full orbitals from scratch. This procedure can help to reduce the basis size and to improve the training stability.</em></p><p>To further enhance the model, we can enlarge the cutoff range considered, to build a model beyond the first nearest neighbours. The parameter <code class="docutils literal notranslate"><span class=pre>r_max</span></code> that controls the cutoff radius is set in <code class="docutils literal notranslate"><span class=pre>info.json</span></code> in the dataset folder.</p><p>We now increase the <code class="docutils literal notranslate"><span class=pre>r_max</span></code> to be larger than the bong-length of the third nearest neighbour, while shorter than the fourth. However, abrupt change in the cutoff will introduce discontinuity in the model training,therefore, a smoothing function is introduced:</p><div class="math notranslate nohighlight">\[f_s(r)=\frac{1}{1+e^{(r-r_{skc})/\omega}}\]</div><p>and that is controlled by parameters in <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> keyword in the <code class="docutils literal notranslate"><span class=pre>model_options</span></code> section of the input file:</p><ul class=simple><li><p><code class="docutils literal notranslate"><span class=pre>rs</span></code> (angstrom unit): <span class="math notranslate nohighlight">\(r_{skc}\)</span> it controls the cutoff of the decay weight of each bond.</p></li><li><p><code class="docutils literal notranslate"><span class=pre>w</span></code>: <span class="math notranslate nohighlight">\(\omega\)</span>, it decides the smoothness of the decay.</p></li></ul><p><img alt=fs src=advanced/img/fs.png></p><p>As is shown in the above figure, this smoothing function will decay centred at <span class="math notranslate nohighlight">\(r_{skc}\)</span>. According to the smoothness <span class="math notranslate nohighlight">\(\omega\)</span>, this function has different smoothness. Here, to take more neighbours’ terms into consideration while retaining the stability of fitting, we first set the <span class="math notranslate nohighlight">\(r_{skc}\)</span> at the first-nearest neighbour distance, this decay function can suppress the newly included second and third neighbour terms, which brings no abrupt changes to the predicted hamiltonians.</p><p>Then what is left is pushing <span class="math notranslate nohighlight">\(r_{skc}\)</span> gradually to the value of <code class="docutils literal notranslate"><span class=pre>bond_cutoff</span></code>. This can be achieved by modifying the parameters in the input configuration and repeating along with training with initialization manually. Alternatively, <strong>DeePTB</strong> support to push the smooth boundary automatically. We can set the <code class="docutils literal notranslate"><span class=pre>push</span></code> keyword in <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model. <code class="docutils literal notranslate"><span class=pre>push</span></code> function takes two kinds of input: either push <code class="docutils literal notranslate"><span class=pre>rs</span></code> by using <code class="docutils literal notranslate"><span class=pre>rs_ths</span></code> or push <code class="docutils literal notranslate"><span class=pre>w</span></code> by using <code class="docutils literal notranslate"><span class=pre>w_ths</span></code>. The rate of the push function is controlled by keyword <code class="docutils literal notranslate"><span class=pre>period</span></code>. An example of the input <code class="docutils literal notranslate"><span class=pre>model_options</span></code> for adding neighbors is as follow:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"strain"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>2.5</span><span class=w> </span><span class=p>,</span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>2.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nt>"push"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"rs_thr"</span><span class=p>:</span><span class=w> </span><span class=mf>0.024</span><span class=p>,</span><span class=w> </span><span class=nt>"period"</span><span class=p>:</span><span class=w> </span><span class=mi>15</span><span class=p>}</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p><strong>DeePTB</strong> will push the <code class="docutils literal notranslate"><span class=pre>rs</span></code> by each step in <code class="docutils literal notranslate"><span class=pre>rs_ths</span></code> in each <code class="docutils literal notranslate"><span class=pre>period</span></code> during training. It is recommended to analyse the bond distribution before pushing. The boundary-pushing often takes more training epochs.</p><p>We can push the <code class="docutils literal notranslate"><span class=pre>rs</span></code> first by running:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>./input/2-2-2_1_input.json<span class=w> </span>-i<span class=w> </span>./nnsk_2/checkpoint/nnsk.ep501.pth<span class=w> </span>-o<span class=w> </span>./nnsk_3
</pre></div></div><p>After we get the converged model, we can further push the <code class="docutils literal notranslate"><span class=pre>w</span></code> by running:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>./input/2-2-2_2_input.json<span class=w> </span>-i<span class=w> </span>./nnsk_3/checkpoint/nnsk.ep1104.pth<span class=w> </span>-o<span class=w> </span>./nnsk_4
</pre></div></div><p>After adding neighbors, the <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model can now fit the bands even better.</p><a class="reference internal image-reference"href=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_push.png><img alt=nnsk_push src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_push.png style=width:500px> </a></section><section id=training-the-bond-length-dependent-parameters><h4>2.3 Training the Bond-length Dependent Parameters<a title="Link to this heading"class=headerlink href=#training-the-bond-length-dependent-parameters>#</a></h4><p>The empirical SK integrals in <strong>DeePTB</strong> are parameterized by various bond-length dependent functions. This provides the representative power of <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model to model the change of electronic structure by atomic distortions. If the user wants to learn the bond-length dependent parameters or would like to add environmental correction to improve the accuracy, or to fit various structures, this step is highly recommended.</p><p>The training of Bond-length Dependence parameters will use the dataset of MD snapshots. By modifying the <code class="docutils literal notranslate"><span class=pre>data_options/train/prefix</span></code> in the input configuration to <code class="docutils literal notranslate"><span class=pre>kpathmd25K/kpathmd100K/kpathmd300K</span></code> and training the model with initialized checkpoints. The parameters are easily attained. This can be done by running:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>./input/2-3_1_input.json<span class=w> </span>-i<span class=w> </span>./nnsk_4/checkpoint/nnsk.ep1501.pth<span class=w> </span>-o<span class=w> </span>./nnsk_md25
</pre></div></div><p>and so on. The bond length dependent model can have a good agreement with the reference bands:</p><a class="reference internal image-reference"href=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_md.png><img alt=band_md src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_md.png style=width:500px> </a><p>We highly suggest training the model from a low temperature, and the transfer to a higher temperature to improve the fitting stability.</p></section></section><section id=training-deep-learning-tb-models-with-env-correction><h3>3. Training Deep Learning TB Models with Env. Correction<a title="Link to this heading"class=headerlink href=#training-deep-learning-tb-models-with-env-correction>#</a></h3><p><strong>DeePTB</strong> provides powerful environmental-dependent modelling with symmetry-preserving neural networks. Based on the last step, we can further enhance the power of TB model to overcome the accuracy limit, brought by the two-centre approximation. The environment correction is added by the embedding and prediction part of the model output:</p><div class="math notranslate nohighlight">\[ \begin{equation} h^{\text{env}}_{ll^\prime{\zeta}} = h_{ll^\prime{\zeta}}(r_{ij}) \times \left[1+\Phi_{ll^\prime\zeta}^{o_i,o_j}\left(r_{ij},\mathcal{D}^{ij}\right)\right] \end{equation} \]</div><p>We denote the model that builds the environmental dependence as <code class="docutils literal notranslate"><span class=pre>dptb</span></code>. To define a <code class="docutils literal notranslate"><span class=pre>dptb</span></code> model in <code class="docutils literal notranslate"><span class=pre>model_options</span></code>, we need:</p><ul class=simple><li><p><code class="docutils literal notranslate"><span class=pre>embedding</span></code>: defines the descriptor of environment.</p></li><li><p><code class="docutils literal notranslate"><span class=pre>prediction</span></code>: defines the size of the correction network.</p></li><li><p><code class="docutils literal notranslate"><span class=pre>nnsk</span></code>: just as the previous <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> inputs. It is important to set keyword <code class="docutils literal notranslate"><span class=pre>freeze</span></code> to <code class="docutils literal notranslate"><span class=pre>true</span></code> when one initializes a new <code class="docutils literal notranslate"><span class=pre>dptb</span></code> model.</p></li></ul><p>With the converged checkpoint in the last step, we can just run:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>./input/2-4_input.json<span class=w> </span>-i<span class=w> </span>./nnsk_md25/checkpoint/nnsk.ep43.pth<span class=w> </span>-o<span class=w> </span>./dptb
</pre></div></div><p>We can use the converged model to predict the bandstructure, calculating properties supported by <strong>DeePTB</strong>, or get the predicted Hamiltonian directly.</p><a class="reference internal image-reference"href=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_dptb.png><img alt=band_dptb src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/silicon_band_dptb.png style=width:500px> </a><p>Now you know how to train a <strong>DeePTB</strong> model, congratulations!</p></section></section></section></article><footer class="prev-next-footer d-print-none"><div class=prev-next-area><a title="previous page"class=left-prev href=dftb.html> <i class="fa-solid fa-angle-left"></i> <div class=prev-next-info><p class=prev-next-subtitle>previous</p><p class=prev-next-title>DFTB SK Files to DeePTB Model</p></div> </a><a title="next page"class=right-next href=nrl_tb.html> <div class=prev-next-info><p class=prev-next-subtitle>next</p><p class=prev-next-title>NRL-TB paramererization</p></div> <i class="fa-solid fa-angle-right"></i> </a></div></footer></div><div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner"><div class=sidebar-secondary-item><div class="page-toc tocsection onthispage"><i class="fa-solid fa-list"></i> Contents</div><nav class="bd-toc-nav page-toc"><ul class="visible nav section-nav flex-column"><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link"href=#method-introduction>Method Introduction:</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link"href=#example-bulk-silicon>Example: Bulk Silicon</a><ul class="nav section-nav flex-column"><li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link"href=#data-preparation>1. Data Preparation</a></li><li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link"href=#training-neural-network-emperical-tb-model-no-env>2. Training Neural Network Emperical TB Model (no env)</a><ul class="nav section-nav flex-column"><li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link"href=#training-a-first-nearest-neighbour-model>2.1 Training a First Nearest Neighbour Model</a></li><li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link"href=#add-more-orbitals-and-neighbours>2.2 Add More Orbitals and Neighbours</a></li><li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link"href=#training-the-bond-length-dependent-parameters>2.3 Training the Bond-length Dependent Parameters</a></li></ul></li><li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link"href=#training-deep-learning-tb-models-with-env-correction>3. Training Deep Learning TB Models with Env. Correction</a></li></ul></li></ul></nav></div></div></div></div><footer class=bd-footer-content><div class="bd-footer-content__inner container"><div class=footer-item><p class=component-author>By DeePTB</p></div><div class=footer-item><p class=copyright>© Copyright 2023, DeePTB. <br></p></div><div class=footer-item></div><div class=footer-item><div class=extra_footer><p><a href=https://beian.miit.gov.cn target=_blank>京ICP备20010051号-8</a></p></div></div></div></footer></main></div></div><script src=../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b></script><script src=../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b></script><footer class=bd-footer></footer></body></html>