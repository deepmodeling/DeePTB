<!doctype html><html data-content_root=../../ lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="width=device-width,initial-scale=1" name=viewport><title>Tutorial 5: 使用 DeePTB 模型结合 TBPLaS 计算材料电学性质 — DeePTB  documentation</title><script data-cfasync=false>document.documentElement.dataset.mode=localStorage.getItem(`mode`)||``,document.documentElement.dataset.theme=localStorage.getItem(`theme`)||``;</script><link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel=stylesheet><link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel=stylesheet><link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel=stylesheet><link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel=stylesheet><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2 rel=preload type=font/woff2><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2 rel=preload type=font/woff2><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2 rel=preload type=font/woff2><link href="../../_static/pygments.css?v=8f2a1f02" rel=stylesheet><link href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" rel=stylesheet><link href=../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css rel=stylesheet><link href="../../_static/banner.css?v=f1520836" rel=stylesheet><link href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" as=script rel=preload><link href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" as=script rel=preload><script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script><script src="../../_static/documentation_options.js?v=9eb32ce0"></script><script src="../../_static/doctools.js?v=9bcbadda"></script><script src="../../_static/sphinx_highlight.js?v=dc90522c"></script><script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script><script src="../../_static/banner.js?v=a6a668d4"></script><script>DOCUMENTATION_OPTIONS.pagename=`quick_start/hands_on/tutorial5_TBPlaS`;</script><link href=../../genindex.html rel=index title=Index><link href=../../search.html rel=search title=Search><link href=../api/index.html rel=next title=APIs><link title="Tutorial 4: Training deeptb-e3 model for Silicon" href=tutorial4_E3_si.html rel=prev><meta content="width=device-width,initial-scale=1" name=viewport><meta content=en name=docsearch:language><link href=https://unpkg.com/ rel=preconnect><link href=https://unpkg.com/@njzjz/icons@0.0.5/logos/deepmodeling.svg rel=icon type=image/png><div class="container-fluid header-holder tutorials-header" id=header-holder><div class=container><div class=header-container><a aria-label=deepmodeling class=header-logo href=https://deepmodeling.com></a><div class=main-menu><ul><li><a href=https://deepmodeling.com>Home</a></li><li><a href=https://blogs.deepmodeling.com>Blog</a></li><li><a href=https://tutorials.deepmodeling.com>Tutorials</a></li><li class="active docs-active"><div class=resources-dropdown data-toggle=resources-dropdown id=resourcesDropdownButton><a class="resource-option with-down-orange-arrow" href=https://docs.deepmodeling.com/> Docs </a><div class=resources-dropdown-menu><a class="doc-dropdown-option nav-dropdown-item" href=https://docs.deepmodeling.com/projects/deepmd/> <span class=dropdown-title>DeePMD-kit</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item" href=https://docs.deepmodeling.com/projects/dpgen/> <span class=dropdown-title>DP-GEN</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item" href=https://docs.deepmodeling.com/projects/dpdata/> <span class=dropdown-title>dpdata</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item" href=https://docs.deepmodeling.com/projects/dpdispatcher/> <span class=dropdown-title>DPDispatcher</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item" href=https://abacus.deepmodeling.com/> <span class=dropdown-title>ABACUS</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item" href=https://deepflame.deepmodeling.com/> <span class=dropdown-title>DeepFlame</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item" href=https://docs.deepmodeling.com/projects/dpti/> <span class=dropdown-title>DPTI</span> <p></p> </a></div></div></li><li><a href=https://blogs.deepmodeling.com/papers/>Publications</a></li><li><a href=https://github.com/deepmodeling>GitHub</a></li></ul></div><a class=main-menu-open-button data-behavior=open-mobile-menu href=#></a></div></div></div><div class=mobile-main-menu><div class=container-fluid><div class=container><div class=mobile-main-menu-header-container><a aria-label=deepmodeling class=header-logo href=https://deepmodeling.com></a><a class=main-menu-close-button data-behavior=close-mobile-menu href=#></a></div></div></div><div class=mobile-main-menu-links-container><div class=main-menu><ul><li><a href=https://deepmodeling.com>Home</a></li><li><a href=https://blogs.deepmodeling.com>Blog</a></li><li><a href=https://tutorials.deepmodeling.com>Tutorials</a></li><li><a href=https://docs.deepmodeling.com/>Docs</a></li><li><a href=https://blogs.deepmodeling.com/papers/>Publications</a></li><li><a href=https://github.com/deepmodeling>GitHub</a></li></ul></div></div></div></head><body data-bs-root-margin="0px 0px -60%" data-bs-spy=scroll data-bs-target=.bd-toc-nav data-default-mode data-offset=180><div class="skip-link d-print-none" id=pst-skip-link><a href=#main-content>Skip to main content</a></div><div id=pst-scroll-pixel-helper></div><button class="btn rounded-pill" id=pst-back-to-top type=button><i class="fa-solid fa-arrow-up"></i>Back to top</button><input class=sidebar-toggle id=pst-primary-sidebar-checkbox type=checkbox><label class="overlay overlay-primary" for=pst-primary-sidebar-checkbox></label><input class=sidebar-toggle id=pst-secondary-sidebar-checkbox type=checkbox><label class="overlay overlay-secondary" for=pst-secondary-sidebar-checkbox></label><div class=search-button__wrapper><div class=search-button__overlay></div><div class=search-button__search-container><form class="bd-search d-flex align-items-center" action=../../search.html><i class="fa-solid fa-magnifying-glass"></i><input aria-label=Search... autocapitalize=off autocomplete=off autocorrect=off class=form-control id=search-input name=q placeholder=Search... spellcheck=false type=search><span class=search-button__kbd-shortcut><kbd class=kbd-shortcut__modifier>Ctrl</kbd>+<kbd>K</kbd></span></form></div></div><div class="pst-async-banner-revealer d-none"><aside aria-label="Version warning" class="d-none d-print-none" id=bd-header-version-warning></aside></div><header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none"></header><div class=bd-container><div class="bd-container__inner bd-page-width"><div class="bd-sidebar-primary bd-sidebar"><div class="sidebar-header-items sidebar-primary__section"></div><div class="sidebar-primary-items__start sidebar-primary__section"><div class=sidebar-primary-item><a class="navbar-brand logo" href=../../index.html> <img alt="DeePTB  documentation - Home" class="logo__image only-light" src=../../_static/deeptb-logo.png> <script>document.write(`<img src="../../_static/deeptb-logo.png" class="logo__image only-dark" alt="DeePTB  documentation - Home"/>`);</script> </a></div><div class=sidebar-primary-item><script>document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);</script></div><div class=sidebar-primary-item><nav class="bd-links bd-docs-nav" aria-label=Main><div class="bd-toc-item navbar-nav active"><p aria-level=2 class=caption role=heading><span class=caption-text>Quick Start</span></p><ul class="current nav bd-sidenav"><li class=toctree-l1><a class="reference internal" href=../easy_install.html>Installation Guide</a></li><li class=toctree-l1><a class="reference internal" href=../input.html>Brief Intro. to Inputs and Commands</a></li><li class="toctree-l1 current active has-children"><a class="reference internal" href=index.html>A quick Example</a><details open><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul class=current><li class=toctree-l2><a class="reference internal" href=tutorial1_base_sk.html>Tutorial 1: deeptb-sk baseline model</a></li><li class=toctree-l2><a class="reference internal" href=tutorial2_data.html>Tutorial 2: data preparation for deeptb-sk model</a></li><li class=toctree-l2><a class="reference internal" href=tutorial3_train_si.html>Tutorial 3: Training deeptb-sk model for Silicon</a></li><li class=toctree-l2><a class="reference internal" href=tutorial4_E3_si.html>Tutorial 4: Training deeptb-e3 model for Silicon</a></li><li class="toctree-l2 current active"><a class="current reference internal" href=#>Tutorial 5: 使用 DeePTB 模型结合 TBPLaS 计算材料电学性质</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal" href=../api/index.html>APIs</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal" href=../api/basic_api.html>Basic API</a></li><li class=toctree-l2><a class="reference internal" href=../api/pythtb_api.html>Exporting DeePTB Models to External Tools (PythTB)</a></li><li class=toctree-l2><a class="reference internal" href=../api/wan90_api.html>Export DeePTB to Wannier90 files</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>INPUT TAG</span></p><ul class="nav bd-sidenav"><li class="toctree-l1 has-children"><a class="reference internal" href=../../input_params/index.html>Full Input Parameters</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal" href=../../input_params/common_options.html>Common Options</a></li><li class=toctree-l2><a class="reference internal" href=../../input_params/train_options.html>Train Options</a></li><li class=toctree-l2><a class="reference internal" href=../../input_params/model_options.html>Model Options</a></li><li class=toctree-l2><a class="reference internal" href=../../input_params/data_options.html>Data Options</a></li><li class=toctree-l2><a class="reference internal" href=../../input_params/run_options.html>Run Options</a></li><li class=toctree-l2><a class="reference internal" href=../../input_params/set_info.html>Set Info</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Advanced</span></p><ul class="nav bd-sidenav"><li class="toctree-l1 has-children"><a class="reference internal" href=../../advanced/sktb/index.html>DeePTB-SK Advanced</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal" href=../../advanced/sktb/dftb.html>DFTB SK Files to DeePTB Model</a></li><li class=toctree-l2><a class="reference internal" href=../../advanced/sktb/dptb_env.html>Environment-dependent TB</a></li><li class=toctree-l2><a class="reference internal" href=../../advanced/sktb/nrl_tb.html>NRL-TB paramererization</a></li><li class=toctree-l2><a class="reference internal" href=../../advanced/sktb/soc.html>Spin-orbit coupling</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal" href=../../advanced/e3tb/index.html>DeePTB-E3 Advanced</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal" href=../../advanced/e3tb/advanced_input.html>More on Input Parameters</a></li><li class=toctree-l2><a class="reference internal" href=../../advanced/e3tb/data_preparation.html>Data Preparation</a></li><li class=toctree-l2><a class="reference internal" href=../../advanced/e3tb/loss_analysis.html>Loss Analysis</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal" href=../../advanced/elec_properties/index.html>Electronic Properties and Outputs</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal" href=../../advanced/elec_properties/band.html>Band structure</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal" href=../../advanced/interface/index.html>Interfaces to Other Softwares</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal" href=../../advanced/interface/TBPLAS.html>TBPLAS</a></li><li class=toctree-l2><a class="reference internal" href=../../advanced/interface/TBtrans.html>TBtrans</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Citing DeePTB</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal" href=../../CITATIONS.html>How to Cite</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Developing Team</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal" href=../../DevelopingTeam.html>Development Team</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Community</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal" href=../../community/contribution_guide.html>DeePTB Contribution Guide</a></li><li class=toctree-l1><a class="reference internal" href=../../CONTRIBUTING.html>Contributing to DeePTB</a></li></ul></div></nav></div></div><div class="sidebar-primary-items__end sidebar-primary__section"></div><div id=rtd-footer-container></div></div><main class=bd-main id=main-content role=main><div class=sbt-scroll-pixel-helper></div><div class=bd-content><div class=bd-article-container><div class="bd-header-article d-print-none"><div class="header-article-items header-article__inner"><div class=header-article-items__start><div class=header-article-item><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement=bottom data-bs-toggle=tooltip><span class="fa-solid fa-bars"></span></button></div></div><div class=header-article-items__end><div class=header-article-item><div class=article-header-buttons><div class="dropdown dropdown-download-buttons"><button aria-label="Download this page" class="btn dropdown-toggle" aria-expanded=false data-bs-toggle=dropdown type=button><i class="fas fa-download"></i></button><ul class=dropdown-menu><li><a class="btn btn-sm btn-download-source-button dropdown-item" title="Download source file" data-bs-placement=left data-bs-toggle=tooltip href=../../_sources/quick_start/hands_on/tutorial5_TBPlaS.ipynb target=_blank> <span class=btn__icon-container> <i class="fas fa-file"></i> </span> <span class=btn__text-container>.ipynb</span> </a></li><li><button class="btn btn-sm btn-download-pdf-button dropdown-item" title="Print to PDF" data-bs-placement=left data-bs-toggle=tooltip onclick=window.print()><span class=btn__icon-container> <i class="fas fa-file-pdf"></i> </span> <span class=btn__text-container>.pdf</span></button></li></ul></div><button class="btn btn-sm btn-fullscreen-button" title="Fullscreen mode" data-bs-placement=bottom data-bs-toggle=tooltip onclick=toggleFullScreen()><span class=btn__icon-container> <i class="fas fa-expand"></i> </span></button><script>document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);</script><script>document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);</script><button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement=bottom data-bs-toggle=tooltip><span class="fa-solid fa-list"></span></button></div></div></div></div></div><div class=onlyprint id=jb-print-docs-body><h1>Tutorial 5: 使用 DeePTB 模型结合 TBPLaS 计算材料电学性质</h1><div id=print-main-content><div id=jb-print-toc><div><h2>Contents</h2></div><nav aria-label=Page><ul class="visible nav section-nav flex-column"><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#>Tutorial 5: 使用 DeePTB 模型结合 TBPLaS 计算材料电学性质</a></li><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#lindhard>1. Lindhard 函数方法计算交流电导率</a><ul class="visible nav section-nav flex-column"><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id1>1.1. 计算设置</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id2>1.2. 性质计算</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id3>1.3. 结果可视化</a></li></ul></li><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#tbpm>2. TBPM 方法计算交流电导率</a><ul class="visible nav section-nav flex-column"><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id4>2.1. 计算设置</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id5>2.2. 性质计算</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id6>2.3. 注意事项与结果可视化</a></li></ul></li><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#id7>3. 总结</a></li></ul></nav></div></div></div><div id=searchbox></div><article class=bd-article><section class="tex2jax_ignore mathjax_ignore" id=tutorial-5-deeptb-tbplas><h1>Tutorial 5: 使用 DeePTB 模型结合 TBPLaS 计算材料电学性质<a title="Link to this heading" class=headerlink href=#tutorial-5-deeptb-tbplas>#</a></h1><p>本教程旨在演示如何使用 <code class="docutils literal notranslate"><span class=pre>DeePTB</span></code> 训练的紧束缚模型，并将其与 <code class="docutils literal notranslate"><span class=pre>TBPLaS</span></code> 软件包相结合，用于计算材料的电学性质，例如交流电导率（AC conductivity）。</p><p>我们将展示两种常用的计算方法：</p><ol class="arabic simple"><li><p><strong>Lindhard 函数方法</strong>：基于 Kubo-Greenwood 公式，通过在k空间中进行密集积分来计算电导率。这种方法精确但计算量较大，尤其是在密集k点网格下。</p></li><li><p><strong>TBPM (Tight-Binding Propagation Method)</strong>：一种线性标度的计算方法，通过时间演化来计算关联函数，从而得到材料性质。该方法对于大体系非常高效，但在小体系上反而不如直接对角化的方案高效。</p></li></ol><hr class=docutils><p><strong>版本信息</strong></p><ul class=simple><li><p><code class="docutils literal notranslate"><span class=pre>tbplas</span></code>: 1.4</p></li><li><p><code class="docutils literal notranslate"><span class=pre>dptb</span></code>: 2.2.1.dev18+3df7b08</p></li></ul><p><strong>注意事项</strong></p><ul class=simple><li><p>DeePTB + TBPLaS 时，模型必须是正交基组</p></li><li><p>E3模型非正交基组，不能用于 TBPLaS</p></li><li><p>SK 模型如果从Baseline 模型出发训练，但是未做正交化处理，也无法用于 TBPLaS</p></li></ul><hr class=docutils><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=kn>from</span><span class=w> </span><span class=nn>dptb.data.build</span><span class=w> </span><span class=kn>import</span> <span class=n>build_dataset</span>
<span class=kn>from</span><span class=w> </span><span class=nn>dptb.data</span><span class=w> </span><span class=kn>import</span> <span class=n>AtomicData</span>
<span class=kn>from</span><span class=w> </span><span class=nn>dptb.nn</span><span class=w> </span><span class=kn>import</span> <span class=n>build_model</span>
<span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<span class=kn>from</span><span class=w> </span><span class=nn>ase.io</span><span class=w> </span><span class=kn>import</span> <span class=n>read</span>
<span class=kn>from</span><span class=w> </span><span class=nn>dptb.postprocess.totbplas</span><span class=w> </span><span class=kn>import</span> <span class=n>TBPLaS</span>
<span class=kn>import</span><span class=w> </span><span class=nn>tbplas</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>tb</span>
<span class=kn>from</span><span class=w> </span><span class=nn>matplotlib</span><span class=w> </span><span class=kn>import</span> <span class=n>pyplot</span> <span class=k>as</span> <span class=n>plt</span>
<span class=c1># from scipy.interpolate import  interpn</span>
<span class=kn>import</span><span class=w> </span><span class=nn>time</span>
</pre></div></div></div><div class="cell_output docutils container"><div class="output traceback highlight-ipythontb notranslate"><div class=highlight><pre><span></span><span class=gt>---------------------------------------------------------------------------</span>
<span class=ne>ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class=n>Cell</span> <span class=n>In</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>line</span> <span class=mi>1</span>
<span class=ne>----> </span><span class=mi>1</span> <span class=kn>from</span><span class=w> </span><span class=nn>dptb.data.build</span><span class=w> </span><span class=kn>import</span> <span class=n>build_dataset</span>
<span class="g g-Whitespace">      </span><span class=mi>2</span> <span class=kn>from</span><span class=w> </span><span class=nn>dptb.data</span><span class=w> </span><span class=kn>import</span> <span class=n>AtomicData</span>
<span class="g g-Whitespace">      </span><span class=mi>3</span> <span class=kn>from</span><span class=w> </span><span class=nn>dptb.nn</span><span class=w> </span><span class=kn>import</span> <span class=n>build_model</span>

<span class=ne>ModuleNotFoundError</span>: No module named 'dptb'
</pre></div></div></div></div></section><section class="tex2jax_ignore mathjax_ignore" id=lindhard><h1>1. Lindhard 函数方法计算交流电导率<a title="Link to this heading" class=headerlink href=#lindhard>#</a></h1><p>Lindhard 函数方法是一种精确的微扰理论方法，适用于计算周期体系的线性响应性质。在这里，我们用它来计算晶体硅的交流电导率。</p><section id=id1><h2>1.1. 计算设置<a title="Link to this heading" class=headerlink href=#id1>#</a></h2><p>在这一步，我们加载 <code class="docutils literal notranslate"><span class=pre>DeePTB</span></code> 模型，读取晶体结构，并设置 <code class="docutils literal notranslate"><span class=pre>TBPLaS</span></code> 计算所需的所有参数。</p><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=c1># --- 输入参数 ---</span>
<span class=c1># DeePTB 模型文件路径</span>
<span class=n>ckpt</span> <span class=o>=</span> <span class=s1>'./mix.latest.pth'</span>
<span class=c1># 晶体结构文件 (VASP POSCAR 格式)</span>
<span class=n>stru_data</span> <span class=o>=</span> <span class=s1>'./conv2.vasp'</span>
<span class=c1># 结果保存路径</span>
<span class=n>results_path</span> <span class=o>=</span> <span class=s1>'./results'</span>
<span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.05</span>
<span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>results_path</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=n>t1</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>process_time</span><span class=p>()</span>
<span class=c1># --- 准备 DeePTB 模型和结构 ---</span>
<span class=c1># 设置原子数据参数，r_max 定义了近邻原子搜索的截断半径</span>
<span class=n>AtomicData_options</span> <span class=o>=</span> <span class=p>{</span><span class=s2>"r_max"</span><span class=p>:</span> <span class=mf>5.1</span><span class=p>,</span> <span class=s2>"er_max"</span><span class=p>:</span> <span class=mf>5.1</span><span class=p>,</span> <span class=s2>"oer_max"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span> <span class=s2>"pbc"</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
<span class=c1># 调用from_ase方法，生成一个硅的AtomicData类型数据</span>
<span class=n>dataset</span> <span class=o>=</span> <span class=n>AtomicData</span><span class=o>.</span><span class=n>from_ase</span><span class=p>(</span><span class=n>atoms</span><span class=o>=</span><span class=n>read</span><span class=p>(</span><span class=n>stru_data</span><span class=p>),</span><span class=o>**</span><span class=n>AtomicData_options</span><span class=p>)</span>
<span class=n>model</span> <span class=o>=</span> <span class=n>build_model</span><span class=p>(</span><span class=n>ckpt</span><span class=p>)</span>
<span class=n>model</span><span class=o>.</span><span class=n>eval</span><span class=p>()</span>

<span class=c1># --- 转换为 TBPLaS 格式 ---</span>
<span class=c1># TBPLaS 是一个辅助类，用于将 DeePTB 模型转换为 TBPLaS 可识别的 Cell 格式</span>
<span class=n>tbplas</span> <span class=o>=</span> <span class=n>TBPLaS</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span> <span class=n>device</span><span class=o>=</span><span class=s2>"cpu"</span><span class=p>)</span>
<span class=n>tbplus_atom</span> <span class=o>=</span> <span class=n>tbplas</span><span class=o>.</span><span class=n>get_cell</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span> <span class=n>e_fermi</span><span class=o>=-</span><span class=mf>8.104654952217583</span><span class=p>)</span>
<span class=n>t2</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>process_time</span><span class=p>()</span>
<span class=c1># --- 设置 Lindhard 计算 ---</span>
<span class=c1># 初始化 Lindhard 计算器</span>
<span class=n>lind</span> <span class=o>=</span> <span class=n>tb</span><span class=o>.</span><span class=n>Lindhard</span><span class=p>(</span><span class=n>cell</span><span class=o>=</span><span class=n>tbplus_atom</span><span class=p>,</span> 
                   <span class=n>energy_max</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>        <span class=c1># 计算的能量范围 (0 到 6 eV)</span>
                   <span class=n>energy_step</span><span class=o>=</span><span class=mi>600</span><span class=p>,</span>     <span class=c1># 能量范围内的插值点数</span>
                   <span class=n>kmesh_size</span><span class=o>=</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span> <span class=c1># k点网格大小，精度关键参数</span>
                   <span class=n>mu</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>              <span class=c1># 化学势 (相对于费米能级)</span>
                   <span class=n>temperature</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span>     <span class=c1># 体系温度 (K)</span>
                   <span class=n>g_s</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>               <span class=c1># 自旋简并度</span>
                   <span class=n>back_epsilon</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span>    <span class=c1># 背景介电常数</span>
                   <span class=n>dimension</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>         <span class=c1># 体系维度</span>
                   <span class=n>delta</span><span class=o>=</span><span class=n>sigma</span>          <span class=c1># 展宽因子</span>
                  <span class=p>)</span>
</pre></div></div></div><div class="cell_output docutils container"><div class="output stderr highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>CUDA is not available. The model will be loaded on CPU.
</pre></div></div><div class="output stderr highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>The model option atomic_radius in nnsk is not defined in input model_options, set to v1.
</pre></div></div><div class="output stream highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>Parallelization details:
  MPI disabled    
  OMP_NUM_THREADS  : n/a   
  MKL_NUM_THREADS  : n/a   
</pre></div></div></div></div></section><section id=id2><h2>1.2. 性质计算<a title="Link to this heading" class=headerlink href=#id2>#</a></h2><p>调用 <code class="docutils literal notranslate"><span class=pre>calc_ac_cond</span></code> 方法执行计算。这一步是计算的核心，也是最耗时的部分，因为它需要在每个k点上对哈密顿量进行对角化以获得本征值和波函数。</p><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=c1># 计算交流电导率，这步非常耗时</span>
<span class=n>t_start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>process_time</span><span class=p>()</span>
<span class=n>omegas</span><span class=p>,</span> <span class=n>ac_cond</span> <span class=o>=</span> <span class=n>lind</span><span class=o>.</span><span class=n>calc_ac_cond</span><span class=p>()</span>
<span class=n>t_end</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>process_time</span><span class=p>()</span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Lindhard AC conductivity calculation time: </span><span class=si>{</span><span class=n>t_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>t_start</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> seconds"</span><span class=p>)</span>
</pre></div></div></div></div></section><section id=id3><h2>1.3. 结果可视化<a title="Link to this heading" class=headerlink href=#id3>#</a></h2><p>绘制交流电导率的实部和虚部随能量（光子能量）的变化关系。</p><ul class=simple><li><p><strong>实部 (Re[σ])</strong>: 代表材料对电磁波的吸收。</p></li><li><p><strong>虚部 (Im[σ])</strong>: 与材料的极化性质相关。</p></li></ul><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>omegas</span><span class=p>,</span> <span class=n>ac_cond</span><span class=o>.</span><span class=n>real</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>'Re(sigma_xx)'</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>omegas</span><span class=p>,</span> <span class=n>ac_cond</span><span class=o>.</span><span class=n>imag</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>'Im(sigma_xx)'</span><span class=p>)</span>

<span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>"Energy (eV)"</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>"sigma_xx"</span><span class=p>)</span>
<span class=c1>#plt.savefig("ACxx.png")</span>
<span class=c1>#np.save(f"{results_path}/AC_cond_sig_{sigma}.npy", {'energy':omegas, 'ACxx': ac_cond})</span>
<span class=n>t3</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>process_time</span><span class=p>()</span>
<span class=nb>print</span><span class=p>(</span><span class=s2>"cal AC time is "</span><span class=p>,</span> <span class=n>t3</span><span class=o>-</span><span class=n>t2</span><span class=p>)</span>
</pre></div></div></div><div class="cell_output docutils container"><div class="output stream highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>cal AC time is  2160.0894419349997
</pre></div></div><img alt=../../_images/62f3b195e4765537a03bab01910f490e72210791169306119a7a31f6b73a6267.png src=../../_images/62f3b195e4765537a03bab01910f490e72210791169306119a7a31f6b73a6267.png></div></div></section></section><section class="tex2jax_ignore mathjax_ignore" id=tbpm><h1>2. TBPM 方法计算交流电导率<a title="Link to this heading" class=headerlink href=#tbpm>#</a></h1><section id=id4><h2>2.1. 计算设置<a title="Link to this heading" class=headerlink href=#id4>#</a></h2><p>TBPM的计算流程与 Lindhard 方法不同。这里我们需要先构建一个大的超胞（SuperCell），然后基于此进行计算。</p><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=c1># --- 输入参数 ---</span>
<span class=n>ckpt</span> <span class=o>=</span> <span class=s1>'./mix.latest.pth'</span>
<span class=n>structfile</span> <span class=o>=</span> <span class=s1>'./conv2.vasp'</span>
<span class=n>results_path</span> <span class=o>=</span> <span class=s1>'./results_tbpm'</span>

<span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>results_path</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

<span class=c1># TBPM 计算参数字典</span>
<span class=n>jdata</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>"e_fermi"</span><span class=p>:</span> <span class=o>-</span><span class=mf>8.104654952217583</span><span class=p>,</span> <span class=c1># 费米能级</span>
    <span class=s2>"rescale_ham"</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span>           <span class=c1># 哈密顿量重整化因子。用于将H的本征值范围缩放到[-1, 1]内。通常需要比最大本征值稍大。</span>
    <span class=s2>"dim"</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>                    <span class=c1># 体系维度</span>
    <span class=s2>"supercell"</span><span class=p>:</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>      <span class=c1># 沿a,b,c方向构建的超胞大小</span>
    <span class=s2>"pbc"</span><span class=p>:</span> <span class=p>[</span><span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>],</span>   <span class=c1># 超胞的周期性边界条件</span>
    <span class=s2>"nsamples"</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>               <span class=c1># 随机矢量采样数。TBPM使用随机相位的矢量进行投影，该值越大，统计噪声越小，结果越准。</span>
    <span class=s2>"ntimes"</span><span class=p>:</span> <span class=mi>1024</span>               <span class=c1># KPM展开的阶数（Chebyshev矩的数量），决定了能量分辨率。</span>
<span class=p>}</span>

<span class=c1># --- 准备 DeePTB 模型和结构 (同上) ---</span>
<span class=n>AtomicData_options</span> <span class=o>=</span> <span class=p>{</span><span class=s2>"r_max"</span><span class=p>:</span> <span class=mf>5.1</span><span class=p>,</span> <span class=s2>"er_max"</span><span class=p>:</span> <span class=mf>5.1</span><span class=p>,</span> <span class=s2>"oer_max"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span> <span class=s2>"pbc"</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
<span class=n>dataset</span> <span class=o>=</span> <span class=n>AtomicData</span><span class=o>.</span><span class=n>from_ase</span><span class=p>(</span><span class=n>atoms</span><span class=o>=</span><span class=n>read</span><span class=p>(</span><span class=n>structfile</span><span class=p>),</span> <span class=o>**</span><span class=n>AtomicData_options</span><span class=p>)</span>

<span class=n>model</span> <span class=o>=</span> <span class=n>build_model</span><span class=p>(</span><span class=n>ckpt</span><span class=p>)</span>
<span class=n>model</span><span class=o>.</span><span class=n>eval</span><span class=p>()</span>
<span class=c1># --- 转换为 TBPLaS 格式并构建超胞 ---</span>
<span class=n>tbplas</span> <span class=o>=</span> <span class=n>TBPLaS</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span> <span class=n>device</span><span class=o>=</span><span class=s2>"cpu"</span><span class=p>)</span>
<span class=n>tbplus_atom</span> <span class=o>=</span> <span class=n>tbplas</span><span class=o>.</span><span class=n>get_cell</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span> <span class=n>e_fermi</span><span class=o>=</span><span class=n>jdata</span><span class=p>[</span><span class=s2>"e_fermi"</span><span class=p>])</span>
<span class=n>super_cell</span> <span class=o>=</span> <span class=n>tb</span><span class=o>.</span><span class=n>SuperCell</span><span class=p>(</span><span class=n>tbplus_atom</span> <span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=n>jdata</span><span class=p>[</span><span class=s2>"supercell"</span><span class=p>]</span> <span class=p>,</span> <span class=n>pbc</span><span class=o>=</span><span class=n>jdata</span><span class=p>[</span><span class=s2>"pbc"</span><span class=p>])</span>

<span class=c1># 从超胞创建计算所需的 Sample 对象</span>
<span class=n>sample</span> <span class=o>=</span> <span class=n>tb</span> <span class=o>.</span><span class=n>Sample</span><span class=p>(</span><span class=n>super_cell</span><span class=p>)</span>
<span class=c1># 重整化哈密顿量</span>
<span class=k>if</span> <span class=n>jdata</span><span class=p>[</span><span class=s2>"rescale_ham"</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>sample</span><span class=o>.</span><span class=n>rescale_ham</span><span class=p>(</span><span class=n>jdata</span><span class=p>[</span><span class=s2>"rescale_ham"</span><span class=p>])</span>
<span class=k>else</span><span class=p>:</span>
    <span class=n>sample</span><span class=o>.</span><span class=n>rescale_ham</span><span class=p>()</span> <span class=c1># 自动寻找重整化因子</span>

<span class=c1># --- 配置 TBPM 计算器 ---</span>
<span class=n>config</span> <span class=o>=</span> <span class=n>tb</span><span class=o>.</span><span class=n>Config</span><span class=p>()</span> 
<span class=n>config</span><span class=o>.</span><span class=n>generic</span><span class=p>[</span><span class=s2>"nr_random_samples"</span><span class=p>]</span> <span class=o>=</span> <span class=n>jdata</span><span class=p>[</span><span class=s1>'nsamples'</span><span class=p>]</span>
<span class=n>config</span><span class=o>.</span><span class=n>generic</span><span class=p>[</span><span class=s2>"nr_time_steps"</span><span class=p>]</span> <span class=o>=</span> <span class=n>jdata</span><span class=p>[</span><span class=s1>'ntimes'</span><span class=p>]</span>
<span class=c1>#config.generic['mu'] = 0.0</span>

<span class=n>config</span><span class=o>.</span><span class=n>generic</span><span class=p>[</span><span class=s1>'correct_spin'</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<span class=c1># config.dyn_pol['q_points'] = [[0.01, 0.01, 0.01]]  # q-points for which the dynamical polarization is calculated. for optical properties, only Gamma point is needed, q->0. small q.</span>
<span class=n>config</span><span class=o>.</span><span class=n>DC_conductivity</span><span class=p>[</span><span class=s1>'energy_limits'</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=o>-</span><span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>

<span class=c1># 创建 TBPM 的求解器 (Solver) 和分析器 (Analyzer)</span>
<span class=n>solver</span> <span class=o>=</span> <span class=n>tb</span><span class=o>.</span><span class=n>Solver</span><span class=p>(</span><span class=n>sample</span><span class=p>,</span> <span class=n>config</span><span class=p>)</span>
<span class=n>analyzer</span> <span class=o>=</span> <span class=n>tb</span><span class=o>.</span><span class=n>Analyzer</span><span class=p>(</span><span class=n>sample</span><span class=p>,</span> <span class=n>config</span><span class=p>)</span>
</pre></div></div></div><div class="cell_output docutils container"><div class="output stderr highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>CUDA is not available. The model will be loaded on CPU.
The model option atomic_radius in nnsk is not defined in input model_options, set to v1.
</pre></div></div><div class="output stream highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>Parallelization details:
  MPI disabled    
  OMP_NUM_THREADS  : n/a   
  MKL_NUM_THREADS  : n/a   

Output details:
  Directory  : sim_data
  Prefix     : 1762845723
</pre></div></div></div></div></section><section id=id5><h2>2.2. 性质计算<a title="Link to this heading" class=headerlink href=#id5>#</a></h2><p>使用 <code class="docutils literal notranslate"><span class=pre>solver</span></code> 计算速度-速度关联函数，然后通过 <code class="docutils literal notranslate"><span class=pre>analyzer</span></code> 进行傅里叶变换得到交流电导率。</p><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=c1># 计算速度-速度关联函数 (correlation function for AC conductivity)</span>
<span class=n>corr_ac</span> <span class=o>=</span> <span class=n>solver</span><span class=o>.</span><span class=n>calc_corr_ac_cond</span><span class=p>()</span>
<span class=c1># 从关联函数计算交流电导率</span>
<span class=n>omegas_ac</span><span class=p>,</span> <span class=n>ac</span> <span class=o>=</span> <span class=n>analyzer</span><span class=o>.</span><span class=n>calc_ac_cond</span><span class=p>(</span><span class=n>corr_ac</span><span class=p>)</span>
</pre></div></div></div><div class="cell_output docutils container"><div class="output stream highlight-myst-ansi notranslate"><div class=highlight><pre><span></span>Time step for propagation:   0.041 fs

 Calculating AC conductivity correlation function.
 Sample            1  of            3
     Timestep           64  of         1024
     Timestep          128  of         1024
     Timestep          192  of         1024
     Timestep          256  of         1024
     Timestep          320  of         1024
     Timestep          384  of         1024
     Timestep          448  of         1024
     Timestep          512  of         1024
     Timestep          576  of         1024
     Timestep          640  of         1024
     Timestep          704  of         1024
     Timestep          768  of         1024
     Timestep          832  of         1024
     Timestep          896  of         1024
     Timestep          960  of         1024
     Timestep         1024  of         1024
 Sample            2  of            3
     Timestep           64  of         1024
     Timestep          128  of         1024
     Timestep          192  of         1024
     Timestep          256  of         1024
     Timestep          320  of         1024
     Timestep          384  of         1024
     Timestep          448  of         1024
     Timestep          512  of         1024
     Timestep          576  of         1024
     Timestep          640  of         1024
     Timestep          704  of         1024
     Timestep          768  of         1024
     Timestep          832  of         1024
     Timestep          896  of         1024
     Timestep          960  of         1024
     Timestep         1024  of         1024
 Sample            3  of            3
     Timestep           64  of         1024
     Timestep          128  of         1024
     Timestep          192  of         1024
     Timestep          256  of         1024
     Timestep          320  of         1024
     Timestep          384  of         1024
     Timestep          448  of         1024
     Timestep          512  of         1024
     Timestep          576  of         1024
     Timestep          640  of         1024
     Timestep          704  of         1024
     Timestep          768  of         1024
     Timestep          832  of         1024
     Timestep          896  of         1024
     Timestep          960  of         1024
     Timestep         1024  of         1024
</pre></div></div></div></div></section><section id=id6><h2>2.3. 注意事项与结果可视化<a title="Link to this heading" class=headerlink href=#id6>#</a></h2><p><strong>重要提示</strong>: TBPM 方法的结果精度与 <code class="docutils literal notranslate"><span class=pre>supercell</span></code> 的尺寸和 <code class="docutils literal notranslate"><span class=pre>nsamples</span></code> 的数量密切相关。</p><ul class=simple><li><p><strong>超胞尺寸 (<code class="docutils literal notranslate"><span class=pre>supercell</span></code>)</strong>: 必须足够大，以消除有限尺寸效应。</p></li><li><p><strong>采样数 (<code class="docutils literal notranslate"><span class=pre>nsamples</span></code>)</strong>: 必须足够多，以降低随机采样的统计噪声。</p></li></ul><p>本教程中使用的 <code class="docutils literal notranslate"><span class=pre>supercell=[5,5,5]</span></code> 和 <code class="docutils literal notranslate"><span class=pre>nsamples=3</span></code> 仅为快速演示，<strong>其结果是不够收敛的，仅供测试流程使用</strong>。在实际研究中，需要对这两个参数进行严格的收敛性测试。</p><p>由于随机采样的存在，原始数据会有很多噪声。我们通常使用高斯滤波对其进行平滑处理，以观察物理趋势。</p><div class="cell docutils container"><div class="cell_input docutils container"><div class="highlight-ipython3 notranslate"><div class=highlight><pre><span></span><span class=kn>import</span><span class=w> </span><span class=nn>scipy.ndimage</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>omegas_ac</span><span class=p>,</span> <span class=n>ac</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>real</span><span class=p>)</span>
<span class=n>ac_filtered</span> <span class=o>=</span> <span class=n>scipy</span><span class=o>.</span><span class=n>ndimage</span><span class=o>.</span><span class=n>gaussian_filter1d</span><span class=p>(</span><span class=n>ac</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>real</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>omegas_ac</span><span class=p>,</span> <span class=n>ac_filtered</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>omegas_ac</span><span class=p>,</span> <span class=n>ac</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>imag</span><span class=p>)</span>
<span class=n>ac_filtered</span> <span class=o>=</span> <span class=n>scipy</span><span class=o>.</span><span class=n>ndimage</span><span class=o>.</span><span class=n>gaussian_filter1d</span><span class=p>(</span><span class=n>ac</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>imag</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>omegas_ac</span><span class=p>,</span> <span class=n>ac_filtered</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>"Energy (eV)"</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>"sigma_xx"</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>xlim</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
<span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</pre></div></div></div><div class="cell_output docutils container"><img alt=../../_images/9507778327ba08bdfde5058f33a4ad92775c5aeeecc35b17dc782584744827c3.png src=../../_images/9507778327ba08bdfde5058f33a4ad92775c5aeeecc35b17dc782584744827c3.png></div></div></section></section><section class="tex2jax_ignore mathjax_ignore" id=id7><h1>3. 总结<a title="Link to this heading" class=headerlink href=#id7>#</a></h1><p>本教程展示了如何将 <code class="docutils literal notranslate"><span class=pre>DeePTB</span></code> 模型与 <code class="docutils literal notranslate"><span class=pre>TBPLaS</span></code> 工具结合，使用两种不同的方法计算了晶体硅的交流电导率：</p><ol class="arabic simple"><li><p><strong>Lindhard 函数方法</strong>：在k空间计算，结果精确，但计算成本高，不适用于大体系。</p></li><li><p><strong>TBPM 方法</strong>：在实空间超胞上计算，是线性标度方法，适用于大体系和复杂体系，但需要仔细进行收敛性测试（超胞尺寸和采样数）。</p></li></ol><p>通过本教程，你应该掌握了 <code class="docutils literal notranslate"><span class=pre>dptb</span></code> -> <code class="docutils literal notranslate"><span class=pre>tbplas</span></code> 的基本流程。你可以尝试修改 <code class="docutils literal notranslate"><span class=pre>kmesh_size</span></code> (Lindhard) 或者 <code class="docutils literal notranslate"><span class=pre>supercell</span></code>, <code class="docutils literal notranslate"><span class=pre>nsamples</span></code> (TBPM) 等参数，观察它们对计算结果和计算耗时的影响，以加深理解。</p></section></article><footer class="prev-next-footer d-print-none"><div class=prev-next-area><a title="previous page" class=left-prev href=tutorial4_E3_si.html> <i class="fa-solid fa-angle-left"></i> <div class=prev-next-info><p class=prev-next-subtitle>previous</p><p class=prev-next-title>Tutorial 4: Training deeptb-e3 model for Silicon</p></div> </a><a title="next page" class=right-next href=../api/index.html> <div class=prev-next-info><p class=prev-next-subtitle>next</p><p class=prev-next-title>APIs</p></div> <i class="fa-solid fa-angle-right"></i> </a></div></footer></div><div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner"><div class=sidebar-secondary-item><div class="page-toc tocsection onthispage"><i class="fa-solid fa-list"></i> Contents</div><nav class="bd-toc-nav page-toc"><ul class="visible nav section-nav flex-column"><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#>Tutorial 5: 使用 DeePTB 模型结合 TBPLaS 计算材料电学性质</a></li><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#lindhard>1. Lindhard 函数方法计算交流电导率</a><ul class="visible nav section-nav flex-column"><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id1>1.1. 计算设置</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id2>1.2. 性质计算</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id3>1.3. 结果可视化</a></li></ul></li><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#tbpm>2. TBPM 方法计算交流电导率</a><ul class="visible nav section-nav flex-column"><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id4>2.1. 计算设置</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id5>2.2. 性质计算</a></li><li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href=#id6>2.3. 注意事项与结果可视化</a></li></ul></li><li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href=#id7>3. 总结</a></li></ul></nav></div></div></div></div><footer class=bd-footer-content><div class="bd-footer-content__inner container"><div class=footer-item><p class=component-author>By DeePTB</p></div><div class=footer-item><p class=copyright>© Copyright 2023, DeePTB. <br></p></div><div class=footer-item></div><div class=footer-item><div class=extra_footer><p><a href=https://beian.miit.gov.cn target=_blank>京ICP备20010051号-8</a></p></div></div></div></footer></main></div></div><script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script><script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script><footer class=bd-footer></footer></body></html>