<!doctypehtml><html data-content_root=../../ lang=en><head><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><meta content=width=device-width,initial-scale=1 name=viewport><title>DeePTB-SK: h-BN — DeePTB  documentation</title><script data-cfasync=false>document.documentElement.dataset.mode=localStorage.getItem(`mode`)||``;document.documentElement.dataset.theme=localStorage.getItem(`theme`)||``</script><link href=../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link href=../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link href=../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link href=../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b rel=stylesheet><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2 rel=preload type=font/woff2><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2 rel=preload type=font/woff2><link as=font crossorigin href=../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2 rel=preload type=font/woff2><link href=../../_static/pygments.css?v=8f2a1f02 rel=stylesheet><link href=../../_static/styles/sphinx-book-theme.css?v=eba8b062 rel=stylesheet><link href=../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css rel=stylesheet><link href=../../_static/banner.css?v=f1520836 rel=stylesheet><link as=script href=../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b rel=preload><link as=script href=../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b rel=preload><script src=../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b></script><script src=../../_static/documentation_options.js?v=9eb32ce0></script><script src=../../_static/doctools.js?v=9bcbadda></script><script src=../../_static/sphinx_highlight.js?v=dc90522c></script><script src=../../_static/scripts/sphinx-book-theme.js?v=887ef09a></script><script>window.MathJax={"options":{"processHtmlClass":`tex2jax_process|mathjax_process|math|output_area`}}</script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js></script><script src=../../_static/banner.js?v=a6a668d4></script><script>DOCUMENTATION_OPTIONS.pagename=`quick_start/hands_on/sktb_hands_on`</script><link href=../../genindex.html rel=index title=Index><link href=../../search.html rel=search title=Search><meta content=width=device-width,initial-scale=1 name=viewport><meta content=en name=docsearch:language><link href=https://unpkg.com/ rel=preconnect><link href=https://unpkg.com/@njzjz/icons@0.0.5/logos/deepmodeling.svg rel=icon type=image/png><div class="container-fluid header-holder tutorials-header"id=header-holder><div class=container><div class=header-container><a aria-label=deepmodeling class=header-logo href=https://deepmodeling.com></a><div class=main-menu><ul><li><a href=https://deepmodeling.com>Home</a></li><li><a href=https://blogs.deepmodeling.com>Blog</a></li><li><a href=https://tutorials.deepmodeling.com>Tutorials</a></li><li class="active docs-active"><div class=resources-dropdown data-toggle=resources-dropdown id=resourcesDropdownButton><a class="resource-option with-down-orange-arrow"href=https://docs.deepmodeling.com/> Docs </a><div class=resources-dropdown-menu><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/deepmd/> <span class=dropdown-title>DeePMD-kit</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpgen/> <span class=dropdown-title>DP-GEN</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpdata/> <span class=dropdown-title>dpdata</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpdispatcher/> <span class=dropdown-title>DPDispatcher</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://abacus.deepmodeling.com/> <span class=dropdown-title>ABACUS</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://deepflame.deepmodeling.com/> <span class=dropdown-title>DeepFlame</span> <p></p> </a><a class="doc-dropdown-option nav-dropdown-item"href=https://docs.deepmodeling.com/projects/dpti/> <span class=dropdown-title>DPTI</span> <p></p> </a></div></div></li><li><a href=https://blogs.deepmodeling.com/papers/>Publications</a></li><li><a href=https://github.com/deepmodeling>GitHub</a></li></ul></div><a class=main-menu-open-button data-behavior=open-mobile-menu href=#></a></div></div></div><div class=mobile-main-menu><div class=container-fluid><div class=container><div class=mobile-main-menu-header-container><a aria-label=deepmodeling class=header-logo href=https://deepmodeling.com></a><a class=main-menu-close-button data-behavior=close-mobile-menu href=#></a></div></div></div><div class=mobile-main-menu-links-container><div class=main-menu><ul><li><a href=https://deepmodeling.com>Home</a></li><li><a href=https://blogs.deepmodeling.com>Blog</a></li><li><a href=https://tutorials.deepmodeling.com>Tutorials</a></li><li><a href=https://docs.deepmodeling.com/>Docs</a></li><li><a href=https://blogs.deepmodeling.com/papers/>Publications</a></li><li><a href=https://github.com/deepmodeling>GitHub</a></li></ul></div></div></div></head><body data-bs-root-margin="0px 0px -60%"data-bs-spy=scroll data-bs-target=.bd-toc-nav data-default-mode data-offset=180><div class="skip-link d-print-none"id=pst-skip-link><a href=#main-content>Skip to main content</a></div><div id=pst-scroll-pixel-helper></div><button class="btn rounded-pill"id=pst-back-to-top type=button><i class="fa-solid fa-arrow-up"></i>Back to top</button><input class=sidebar-toggle id=pst-primary-sidebar-checkbox type=checkbox><label class="overlay overlay-primary"for=pst-primary-sidebar-checkbox></label><input class=sidebar-toggle id=pst-secondary-sidebar-checkbox type=checkbox><label class="overlay overlay-secondary"for=pst-secondary-sidebar-checkbox></label><div class=search-button__wrapper><div class=search-button__overlay></div><div class=search-button__search-container><form class="bd-search d-flex align-items-center"action=../../search.html><i class="fa-solid fa-magnifying-glass"></i><input aria-label=Search... autocapitalize=off autocomplete=off autocorrect=off class=form-control id=search-input name=q placeholder=Search... spellcheck=false type=search><span class=search-button__kbd-shortcut><kbd class=kbd-shortcut__modifier>Ctrl</kbd>+<kbd>K</kbd></span></form></div></div><div class="pst-async-banner-revealer d-none"><aside aria-label="Version warning"class="d-none d-print-none"id=bd-header-version-warning></aside></div><header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none"></header><div class=bd-container><div class="bd-container__inner bd-page-width"><div class="bd-sidebar-primary bd-sidebar"><div class="sidebar-header-items sidebar-primary__section"></div><div class="sidebar-primary-items__start sidebar-primary__section"><div class=sidebar-primary-item><a class="navbar-brand logo"href=../../index.html> <img alt="DeePTB  documentation - Home"class="logo__image only-light"src=../../_static/deeptb-logo.svg> <script>document.write(`<img src="../../_static/deeptb-logo.svg" class="logo__image only-dark" alt="DeePTB  documentation - Home"/>`)</script> </a></div><div class=sidebar-primary-item><script>document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `)</script></div><div class=sidebar-primary-item><nav class="bd-links bd-docs-nav"aria-label=Main><div class="bd-toc-item navbar-nav active"><p aria-level=2 class=caption role=heading><span class=caption-text>Quick Start</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../easy_install.html>Installation Guide</a></li><li class=toctree-l1><a class="reference internal"href=../input.html>Brief Intro. to Inputs and Commands</a></li><li class="toctree-l1 has-children"><a class="reference internal"href=index.html>A quick Example</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=tutorial1_base_sk.html>Tutorial 1: deeptb-sk baseline model</a></li><li class=toctree-l2><a class="reference internal"href=tutorial2_data.html>Tutorial 2: data preparation for deeptb-sk model</a></li><li class=toctree-l2><a class="reference internal"href=tutorial3_train_si.html>Tutorial 3: Training deeptb-sk model for Silicon</a></li><li class=toctree-l2><a class="reference internal"href=tutorial4_E3_si.html>Tutorial 4: Training deeptb-e3 model for Silicon</a></li></ul></details></li><li class=toctree-l1><a class="reference internal"href=../basic_api.html>Basic API</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>INPUT TAG</span></p><ul class="nav bd-sidenav"><li class="toctree-l1 has-children"><a class="reference internal"href=../../input_params/index.html>Full Input Parameters</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../input_params/common_options.html>Common Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/train_options.html>Train Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/model_options.html>Model Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/data_options.html>Data Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/run_options.html>Run Options</a></li><li class=toctree-l2><a class="reference internal"href=../../input_params/set_info.html>Set Info</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Advanced</span></p><ul class="nav bd-sidenav"><li class="toctree-l1 has-children"><a class="reference internal"href=../../advanced/sktb/index.html>DeePTB-SK Advanced</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../advanced/sktb/dftb.html>DFTB SK Files to DeePTB Model</a></li><li class=toctree-l2><a class="reference internal"href=../../advanced/sktb/dptb_env.html>Environment-dependent TB</a></li><li class=toctree-l2><a class="reference internal"href=../../advanced/sktb/nrl_tb.html>NRL-TB paramererization</a></li><li class=toctree-l2><a class="reference internal"href=../../advanced/sktb/soc.html>Spin-orbit coupling</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal"href=../../advanced/e3tb/index.html>DeePTB-E3 Advanced</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../advanced/e3tb/advanced_input.html>More on Input Parameters</a></li><li class=toctree-l2><a class="reference internal"href=../../advanced/e3tb/data_preparation.html>Data Preparation</a></li><li class=toctree-l2><a class="reference internal"href=../../advanced/e3tb/loss_analysis.html>Loss Analysis</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal"href=../../advanced/elec_properties/index.html>Electronic Properties and Outputs</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../advanced/elec_properties/band.html>Band structure</a></li></ul></details></li><li class="toctree-l1 has-children"><a class="reference internal"href=../../advanced/interface/index.html>Interfaces to Other Softwares</a><details><summary><span class=toctree-toggle role=presentation><i class="fa-solid fa-chevron-down"></i></span></summary><ul><li class=toctree-l2><a class="reference internal"href=../../advanced/interface/TBPLAS.html>TBPLAS</a></li><li class=toctree-l2><a class="reference internal"href=../../advanced/interface/TBtrans.html>TBtrans</a></li></ul></details></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Citing DeePTB</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../CITATIONS.html>How to Cite</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Developing Team</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../DevelopingTeam.html>Development Team</a></li></ul><p aria-level=2 class=caption role=heading><span class=caption-text>Community</span></p><ul class="nav bd-sidenav"><li class=toctree-l1><a class="reference internal"href=../../community/contribution_guide.html>DeePTB Contribution Guide</a></li><li class=toctree-l1><a class="reference internal"href=../../CONTRIBUTING.html>Contributing to DeePTB</a></li></ul></div></nav></div></div><div class="sidebar-primary-items__end sidebar-primary__section"></div><div id=rtd-footer-container></div></div><main class=bd-main id=main-content role=main><div class=sbt-scroll-pixel-helper></div><div class=bd-content><div class=bd-article-container><div class="bd-header-article d-print-none"><div class="header-article-items header-article__inner"><div class=header-article-items__start><div class=header-article-item><button class="sidebar-toggle primary-toggle btn btn-sm"title="Toggle primary sidebar"data-bs-placement=bottom data-bs-toggle=tooltip><span class="fa-solid fa-bars"></span></button></div></div><div class=header-article-items__end><div class=header-article-item><div class=article-header-buttons><div class="dropdown dropdown-download-buttons"><button aria-label="Download this page"class="btn dropdown-toggle"aria-expanded=false data-bs-toggle=dropdown type=button><i class="fas fa-download"></i></button><ul class=dropdown-menu><li><a class="btn btn-sm btn-download-source-button dropdown-item"title="Download source file"data-bs-placement=left data-bs-toggle=tooltip href=../../_sources/quick_start/hands_on/sktb_hands_on.md target=_blank> <span class=btn__icon-container> <i class="fas fa-file"></i> </span> <span class=btn__text-container>.md</span> </a></li><li><button class="btn btn-sm btn-download-pdf-button dropdown-item"title="Print to PDF"data-bs-placement=left data-bs-toggle=tooltip onclick=window.print()><span class=btn__icon-container> <i class="fas fa-file-pdf"></i> </span> <span class=btn__text-container>.pdf</span></button></li></ul></div><button class="btn btn-sm btn-fullscreen-button"title="Fullscreen mode"data-bs-placement=bottom data-bs-toggle=tooltip onclick=toggleFullScreen()><span class=btn__icon-container> <i class="fas fa-expand"></i> </span></button><script>document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`)</script><script>document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`)</script></div></div></div></div></div><div class=onlyprint id=jb-print-docs-body><h1>DeePTB-SK: h-BN</h1><div id=print-main-content><div id=jb-print-toc></div></div></div><div id=searchbox></div><article class=bd-article><section class="tex2jax_ignore mathjax_ignore"id=deeptb-sk-h-bn><h1>DeePTB-SK: h-BN<a title="Link to this heading"class=headerlink href=#deeptb-sk-h-bn>#</a></h1><p>DeePTB is a package that utilizes machine-learning method to train TB models for target systems with the DFT training data. Here, h-BN monolayer has been chosen as a quick start example.</p><p>hBN is a binary compound made of equal numbers of boron (B) and nitrogen (N), we present this as a quick hands-on example. The prepared files are located in:</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span>deeptb/examples/hBN/
├── data
│   ├── kpath.0
│   │   ├── eigenvalues.npy
│   │   ├── info.json
│   │   ├── kpoints.npy
│   │   └── xdat.traj
│   └── struct.vasp
├── input
│   ├── input_first.json
│   ├── input_condband.json
│   ├── input_strain.json
│   ├── input_push_rs.json
|   ├── input_push_w.json
│   └── input_final.json
├── run
│   └── band.json
├── input_short.json
├── ref_ckpts/
├── band_plot/
├── band_plot.py
└── band_plot.ipynb

</pre></div></div><p>The <code class="docutils literal notranslate"><span class=pre>input_short.json</span></code> file contains the least number of parameters that are required to start training the <strong>DeePTB</strong> model. <code class="docutils literal notranslate"><span class=pre>data</span></code> folder contains the bandstructure data <code class="docutils literal notranslate"><span class=pre>kpath.0</span></code>, where another important configuration file <code class="docutils literal notranslate"><span class=pre>info.json</span></code> is located. <code class="docutils literal notranslate"><span class=pre>input</span></code> folder contains the input files for different training stages. <code class="docutils literal notranslate"><span class=pre>run</span></code> folder contains the json for plotting the bandstructure. The <code class="docutils literal notranslate"><span class=pre>ref_ckpts</span></code> folder contains the reference checkpoints for the model at different training stages. The <code class="docutils literal notranslate"><span class=pre>band_plot</span></code> folder contains the bandstructure plot. The <code class="docutils literal notranslate"><span class=pre>band_plot.py</span></code> and <code class="docutils literal notranslate"><span class=pre>band_plot.ipynb</span></code> is the script for plotting the bandstructure.</p><p>First we need to specify the maximum cutoff in building the AtomicData graph in <code class="docutils literal notranslate"><span class=pre>info.json</span></code>. Here, we set the <code class="docutils literal notranslate"><span class=pre>r_max</span></code> large enough to contain the 3rd neighbour. This can be assisted by running <code class="docutils literal notranslate"><span class=pre>dptb</span> <span class=pre>bond</span></code> command:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span><span class=nb>cd</span><span class=w> </span>deeptb/examples/hBN/data
<span class=c1># to see the bond length</span>
dptb<span class=w> </span>bond<span class=w> </span>struct.vasp<span class=w>  </span>
<span class=c1># output:</span>
Bond<span class=w> </span>Type<span class=w>         </span><span class=m>1</span><span class=w>         </span><span class=m>2</span><span class=w>         </span><span class=m>3</span><span class=w>         </span><span class=m>4</span><span class=w>         </span><span class=m>5</span>
------------------------------------------------------------------------
<span class=w>       </span>N-N<span class=w>      </span><span class=m>2</span>.50<span class=w>      </span><span class=m>4</span>.34<span class=w>      </span><span class=m>5</span>.01
<span class=w>       </span>N-B<span class=w>      </span><span class=m>1</span>.45<span class=w>      </span><span class=m>2</span>.89<span class=w>      </span><span class=m>3</span>.82<span class=w>      </span><span class=m>5</span>.21<span class=w>      </span><span class=m>5</span>.78
<span class=w>       </span>B-B<span class=w>      </span><span class=m>2</span>.50<span class=w>      </span><span class=m>4</span>.34<span class=w>      </span><span class=m>5</span>.01
</pre></div></div><p>Having the data file and input parameter, we can start training our first <strong>DeePTB</strong> model from scratch. The first step using the parameters defined in <code class="docutils literal notranslate"><span class=pre>input_short.json</span></code> and we list some important parameters:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w> </span><span class=nt>"common_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"basis"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nt>"B"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>"2s"</span><span class=p>,</span><span class=w> </span><span class=s2>"2p"</span><span class=p>],</span>
<span class=w>                </span><span class=nt>"N"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>"2s"</span><span class=p>,</span><span class=w> </span><span class=s2>"2p"</span><span class=p>]</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nt>"device"</span><span class=p>:</span><span class=w> </span><span class=s2>"cpu"</span><span class=p>,</span>
<span class=w>            </span><span class=nt>"dtype"</span><span class=p>:</span><span class=w> </span><span class=s2>"float32"</span><span class=p>,</span>
<span class=w>            </span><span class=nt>"overlap"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nt>"seed"</span><span class=p>:</span><span class=w> </span><span class=mi>120478</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span>
<span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"none"</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"soc"</span><span class=p>:{},</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nt>"push"</span><span class=p>:</span><span class=kc>false</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>We are training a <strong>DeePTB</strong> model using Slater-Kohster parameterization, so we need to build the <code class="docutils literal notranslate"><span class=pre>nnsk</span></code> model here. The <code class="docutils literal notranslate"><span class=pre>method</span></code> of <code class="docutils literal notranslate"><span class=pre>onsite</span></code> is set to <code class="docutils literal notranslate"><span class=pre>none</span></code>, which means we do not use onsite correction. The <code class="docutils literal notranslate"><span class=pre>rs</span></code> of <code class="docutils literal notranslate"><span class=pre>hopping</span></code> is set to <code class="docutils literal notranslate"><span class=pre>1.6</span></code> which means we use the 1st nearest neighbour for building hopping integrals for now. The <code class="docutils literal notranslate"><span class=pre>basis</span></code> for each element is set to <code class="docutils literal notranslate"><span class=pre>2s</span></code> and <code class="docutils literal notranslate"><span class=pre>2p</span></code> which means we use <span class="math notranslate nohighlight">\(2s\)</span> and <span class="math notranslate nohighlight">\(2p\)</span> orbitals as basis.</p><p>Since we are using only the valence orbitals at this stage, we can limit the energy window for training in the dataset configuration file <code class="docutils literal notranslate"><span class=pre>info.json</span></code> as the follwing:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"bandinfo"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"band_min"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<span class=w>        </span><span class=nt>"band_max"</span><span class=p>:</span><span class=w> </span><span class=mi>6</span><span class=p>,</span>
<span class=w>        </span><span class=nt>"emin"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
<span class=w>        </span><span class=nt>"emax"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>Using the follwing command and we can train the first model:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span><span class=nb>cd</span><span class=w> </span>deeptb/examples/hBN
dptb<span class=w> </span>train<span class=w> </span>./input/input_first.json<span class=w> </span>-o<span class=w> </span>./first
</pre></div></div><p>Here <code class="docutils literal notranslate"><span class=pre>-o</span></code> indicate the output directory. During the fitting procedure, we can see the loss curve of hBN is decrease consistently. When finished, we get the fitting results in folders <code class="docutils literal notranslate"><span class=pre>first</span></code>.</p><p>By modify the checkpoint path in the script <code class="docutils literal notranslate"><span class=pre>plot_band.py</span></code> and running it, the band structure can be obtained in <code class="docutils literal notranslate"><span class=pre>./band_plot</span></code>:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>python<span class=w> </span>plot_band.py
</pre></div></div><p>or just using the command line</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>run<span class=w> </span>./run/band.json<span class=w> </span>-i<span class=w> </span>./first/checkpoint/nnsk.best.pth<span class=w> </span>-o<span class=w> </span>./band_plot
</pre></div></div><blockquote><div><p>Note: the <code class="docutils literal notranslate"><span class=pre>basis</span></code> setting in the plotting script must be the same as in the input.</p></div></blockquote><p><img alt=band_first src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/hBN_band_first.png></p><p>It shows that the fitting has learned the rough shape of the valence bandstructure. To fit the conduction bandstructure, we need to add extra polarized orbitals to the atoms. The polarized orbitals can be added in the <code class="docutils literal notranslate"><span class=pre>input.json</span></code> by modifying the <code class="docutils literal notranslate"><span class=pre>basis</span></code> setting:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"basis"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"B"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>"2s"</span><span class=p>,</span><span class=w> </span><span class=s2>"2p"</span><span class=p>,</span><span class=w> </span><span class=s2>"d*"</span><span class=p>],</span>
<span class=w>        </span><span class=nt>"N"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>"2s"</span><span class=p>,</span><span class=w> </span><span class=s2>"2p"</span><span class=p>,</span><span class=w> </span><span class=s2>"d*"</span><span class=p>]</span>
<span class=w>        </span><span class=p>}</span>
</pre></div></div><p>To train the conduction band, the energy window we previously set in <code class="docutils literal notranslate"><span class=pre>info.json</span></code> can now be discarded by setting <code class="docutils literal notranslate"><span class=pre>emin</span></code> and <code class="docutils literal notranslate"><span class=pre>emax</span></code> to <code class="docutils literal notranslate"><span class=pre>null</span></code>.</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"bandinfo"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"band_min"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<span class=w>        </span><span class=nt>"band_max"</span><span class=p>:</span><span class=w> </span><span class=mi>6</span><span class=p>,</span>
<span class=w>        </span><span class=nt>"emin"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
<span class=w>        </span><span class=nt>"emax"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>We can then start the training using the previous model and modified input:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>input/input_condband.json<span class=w> </span>-i<span class=w> </span>./first/checkpoint/nnsk.ep500.pth<span class=w> </span>-o<span class=w> </span>./condband
</pre></div></div><p><code class="docutils literal notranslate"><span class=pre>-i</span></code> states initialize the model from the checkpoint file, where the previous model is provided.</p><blockquote><div><p>The modified input files are provided in <code class="docutils literal notranslate"><span class=pre>./inputs</span></code> as references.</p></div></blockquote><p>After the training is finished, you can get the result in <code class="docutils literal notranslate"><span class=pre>condband</span></code> folder.</p><p>After training, we can plot the bandstructure again using the script:</p><p><img alt=condband src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/hBN_band_condband.png></p><p>We can further improve the accuracy by incorporating more features of our code, for example, the onsite correction. There are two kinds of onsite correction supported: <code class="docutils literal notranslate"><span class=pre>uniform</span></code> or <code class="docutils literal notranslate"><span class=pre>strain</span></code>. We use <code class="docutils literal notranslate"><span class=pre>strain</span></code> for now to see the effect. Now change the <code class="docutils literal notranslate"><span class=pre>input_short.json</span></code> by the parameters:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"strain"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>After setting we can run the training for strain model:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>input/input_strain.json<span class=w>  </span>-i<span class=w> </span>./condband/checkpoint/nnsk.ep500.pth<span class=w> </span>-o<span class=w> </span>./strain
</pre></div></div><p>We can also plot the band structure of the strain model:</p><p><img alt=band_strain src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/hBN_band_strain.png></p><p>It looks ok, we can further improve the accuracy by adding more neighbours, and training for a longer time. We can gradually increase the decay function cutoff <code class="docutils literal notranslate"><span class=pre>rs</span></code> from 1st to 3rd neighbour. This can be done by changing the <code class="docutils literal notranslate"><span class=pre>model_options</span></code> in the <code class="docutils literal notranslate"><span class=pre>input_short.json</span></code> as follow:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"strain"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"soc"</span><span class=p>:{},</span>
<span class=w>            </span><span class=nt>"push"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"rs_thr"</span><span class=p>:</span><span class=w> </span><span class=mf>0.02</span><span class=p>,</span><span class=w> </span><span class=nt>"period"</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>This means that we gradually add up the <code class="docutils literal notranslate"><span class=pre>rs</span></code> in decay function, pushing up to 3rd nearest neighbour for considering in calculating bonding. see the input file <code class="docutils literal notranslate"><span class=pre>hBN/input/input_push_rs.json</span></code> for detail. Then we can run the training again:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>input/input_push_rs.json<span class=w>  </span>-i<span class=w> </span>./strain/checkpoint/nnsk.ep500.pth<span class=w> </span>-o<span class=w> </span>./push_rs
</pre></div></div><p>We finally get the model with more neighbors. We can plot the result again:</p><p><img alt=band_varycutoff src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/hBN_band_pushrs.png></p><p>we can further push the decay w to 0.2 and train the model again. modify the model options:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"strain"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>3.4</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"soc"</span><span class=p>:{},</span>
<span class=w>            </span><span class=nt>"push"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"w_thr"</span><span class=p>:</span><span class=w> </span><span class=mf>-0.001</span><span class=p>,</span><span class=w> </span><span class=nt>"period"</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><p>note: we change the hopping cutoff <code class="docutils literal notranslate"><span class=pre>rs</span></code> to 3.4, and the push w_thr to -0.001.</p><p>see the input file <code class="docutils literal notranslate"><span class=pre>hBN/input/input_push_w.json</span></code> and run the training:</p><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>input/input_push_w.json<span class=w>  </span>-i<span class=w> </span>./push_rs/checkpoint/nnsk.iter_rs3.400_w0.300.pth<span class=w> </span>-o<span class=w> </span>./push_w
</pre></div></div><p>We can the plot the band structure again:</p><p><img alt=band_varycutoff src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/hBN_band_pushw.png></p><p>We can again increase more training epochs, using the pushed parameters and turn off push tag. see the input file <code class="docutils literal notranslate"><span class=pre>hBN/input/input_final.json</span></code> and run the training:</p><div class="highlight-json notranslate"><div class=highlight><pre><span></span><span class=w>    </span><span class=nt>"model_options"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>"nnsk"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>"onsite"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"strain"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>1.6</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=mf>0.3</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"hopping"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>"method"</span><span class=p>:</span><span class=w> </span><span class=s2>"powerlaw"</span><span class=p>,</span><span class=w> </span><span class=nt>"rs"</span><span class=p>:</span><span class=mf>3.4</span><span class=p>,</span><span class=w> </span><span class=nt>"w"</span><span class=p>:</span><span class=w> </span><span class=mf>0.2</span><span class=p>},</span>
<span class=w>            </span><span class=nt>"soc"</span><span class=p>:{},</span>
<span class=w>            </span><span class=nt>"push"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nt>"freeze"</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</pre></div></div><div class="highlight-bash notranslate"><div class=highlight><pre><span></span>dptb<span class=w> </span>train<span class=w> </span>input/input_final.json<span class=w>  </span>-i<span class=w> </span>./push_w/checkpoint/nnsk.iter_rs3.400_w0.210.pth<span class=w> </span>-o<span class=w> </span>./final
</pre></div></div><p>And we can get a fairly good fitting result:</p><p><img alt=band_longtrain src=https://raw.githubusercontent.com/deepmodeling/DeePTB/main/docs/img/hBN_band_longtrain.png></p><p>Now you have learned the basis use of <strong>DeePTB</strong>, however, the advanced functions still need to be explored for accurate and flexible electron structure representation, such as:</p><ul class=simple><li><p>environmental correction</p></li><li><p>spin-orbital interaction</p></li><li><p>…</p></li></ul><p>Altogether, we can simulate the electronic structure of a crystal system in a dynamic trajectory. <strong>DeePTB</strong> is capable of handling atom movement, volume change under stress, SOC effect and can use DFT eigenvalues with different orbitals and xc functionals as training targets.</p></section></article><footer class="prev-next-footer d-print-none"><div class=prev-next-area></div></footer></div></div><footer class=bd-footer-content><div class="bd-footer-content__inner container"><div class=footer-item><p class=component-author>By DeePTB</p></div><div class=footer-item><p class=copyright>© Copyright 2023, DeePTB. <br></p></div><div class=footer-item></div><div class=footer-item><div class=extra_footer><p><a href=https://beian.miit.gov.cn target=_blank>京ICP备20010051号-8</a></p></div></div></div></footer></main></div></div><script src=../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b></script><script src=../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b></script><footer class=bd-footer></footer></body></html>